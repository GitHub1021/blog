<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="以梦为马，明日天涯">
<meta property="og:type" content="website">
<meta property="og:title" content="冯玮的博客">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="冯玮的博客">
<meta property="og:description" content="以梦为马，明日天涯">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="冯玮">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>冯玮的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">冯玮的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">码农</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-主页">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>主页</a>

  </li>
        <li class="menu-item menu-item-主题">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>主题</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/25/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%88%9B%E5%BB%BA%E5%92%8C%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="冯玮">
      <meta itemprop="description" content="以梦为马，明日天涯">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="冯玮的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/25/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%88%9B%E5%BB%BA%E5%92%8C%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">java多线程的创建和使用</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-11-25 08:55:30 / 修改时间：08:56:07" itemprop="dateCreated datePublished" datetime="2020-11-25T08:55:30+08:00">2020-11-25</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="线程概述与线程创建和使用"><a href="#线程概述与线程创建和使用" class="headerlink" title="线程概述与线程创建和使用"></a>线程概述与线程创建和使用</h1><h2 id="1-线程概述"><a href="#1-线程概述" class="headerlink" title="1.线程概述"></a>1.线程概述</h2><p><code>进程</code>是表示资源分配的基本单位.又是调度运行的基本单位.例如:用户运行自己的程序,系统就创建一个进程,并为他分配资源,包括各种表格,内存空间,磁盘空间,I/O设备等,然后把该进程放入进程的就绪队列,进程调度程序选中它,为他分配CPU以及其他有关资源,该进程才真正运行,所以进程是系统中的并发执行的单位.如下图所示,在windows中通过查看任务管理器的方式,我们就可以清楚的看到windows当前运行的进行</p>
<p><img src="https://img-blog.csdnimg.cn/20191102171113712.png" alt="在这里插入图片描述"></p>
<p><code>线程</code>是进程中执行运算的最小单位,亦即执行处理机调度的基本单位.如果把进程理解为在逻辑上操作系统所完成的任务，那么线程表示完成该任务的许多可能的子任务之一。例如，假设用户启动了一个窗口中的数据库应用程序，操作系统就将对数据库的调用表示为一个进程。假设用户要从数据库中产生一份工资单报表，并传到一个文件中，这是一个子任务；在产生工资单报表的过程中，用户又可以输人数据库查询请求，这又是一个子任务。这样，操作系统则把每一个请求――工资单报表和新输人的数据查询表示为数据库进程中的独立的线程。线程可以在处理器上独立调度执行，这样，在多处理器环境下就允许几个线程各自在单独处理器上进行。操作系统提供线程就是为了方便而有效地实现这种并发性。</p>
<p>一个cpu在任意时刻，只能执行一个线程任务，我们平时一边浏览网页，一边听音乐的场景其实是依赖cpu高速地线程间切换实现地，这也引出了一组容易混淆地概念：**并发(Concurrency)和并行(Parallelism)**。</p>
<p>它们都可以表示两个或者多个任务一起执行，但是偏重点有些不同。并发偏重于多个任务交替执行，而多个任务之间有可能还是串行的，而并行是真正意义上的“同时执行”，它依赖于多核cpu而实现</p>
<p>引入线程的好处:</p>
<ul>
<li>易于调度</li>
<li>提高并发性,通过线程可方便有效地实现并发性,进程可创建多个线程来执行同一程序的不同部分</li>
<li>开销小,创建线程比创建进程要快,所需开销很少</li>
<li>利于充分发挥多处理器的功能,通过创建多线程进程,每个线程在一个处理器上运行.从而实现应用程序的并发性.使每一个处理器都得到充分运行</li>
</ul>
<p>进程和线程的关系:</p>
<ul>
<li>一个线程只能属于一个进程，而一个进程可以有多个线程，但至少有一个线程。线程是操作系统可识别的最小执行和调度单位。</li>
<li>资源分配给进程，同一进程的所有线程共享该进程的所有资源。 同一进程中的多个线程共享代码段(代码和常量)，数据段(全局变量和静态变量)，扩展段(堆存储)。但是每个线程拥有自己的栈段，栈段又叫运行时段，用来存放所有局部变量和临时变量。</li>
<li>处理机分给线程，即真正在处理机上运行的是线程。</li>
<li>线程在执行过程中，需要协作同步。不同进程的线程间要利用消息通信的办法实现同步。</li>
</ul>
<p>###　１.1线程生命周期</p>
<p>线程是一个动态执行的过程,它也有一个从生产到死亡的过程:</p>
<p><img src="https://img-blog.csdnimg.cn/2019110217044331.png" alt="在这里插入图片描述"></p>
<ol>
<li>新建状态:New,使用new关键字和Thread类或其子类建立一个线程对象后,该线程对象就处于新建状态,他保持这个状态知道程序start()这个线程</li>
<li>就绪状态:Runnable当线程对象调用了<code>start()</code>方法后.该线程就进入就绪状态,就绪状态的线程处于就绪队列中.要等待JVM里线程调度的调度</li>
<li>Running 如果就绪状态的线程获取CPU资源,局可以执行<code>run()</code>,此时线程便处于运行状态,处于运行状态的线程最为复杂,他可以变为阻塞状态,就绪状态和死亡状态</li>
<li>阻塞状态:Blocked 如果线程执行了<code>sleep(睡眠)</code>,<code>suspend(挂起)</code>等方法,失去占用资源之后.该线程就从运行状态.进入阻塞状态,在睡眠已到获得设备资源后可以重新进入就绪状态,可以分为三种:<ol>
<li>等待阻塞:运行状态中的线程执行<code>wait()</code>方法.使线程进入到等待阻塞状态</li>
<li>同步阻塞:线程在获取<code>synchronized</code>同步锁失败(因为同步锁被其他线程占用)</li>
<li>其他阻塞:通过调用线程的<code>sleep()</code>或<code>join()</code>发出I/O请求时,线程就会进入到阻塞状态,当<code>sleep()</code>状态超时,<code>join()</code>等待线程终止或超时,或者I/O处理完毕,线程重新转入就绪状态</li>
</ol>
</li>
<li>死亡状态:Dead,一个运行状态的线程,完成任务或者其他终止条件发生时,该线程就切换到终止状态</li>
</ol>
<h2 id="2-多线程实现方式"><a href="#2-多线程实现方式" class="headerlink" title="2.多线程实现方式"></a>2.多线程实现方式</h2><p>Java 提供了三种创建线程的方法：</p>
<ul>
<li>通过继承 Thread 类本身。</li>
<li>通过实现 Runnable 接口。</li>
<li>通过 Callable 和 Future 创建线程。</li>
</ul>
<h3 id="2-1继承Thread"><a href="#2-1继承Thread" class="headerlink" title="2.1继承Thread"></a>2.1继承Thread</h3><p>创建一个线程的第一种方法是创建一个类并继承Thread类,然后创建该类的实例,继承类必须重写run()方法,该方法是新线程的入口点,他也必须调用start()方法才能执行.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyThread</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        System.out.println(<span class="string">&quot;创建线程: &quot;</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;创建线程:&quot;</span> + name + i);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;\t\n退出线程: &quot;</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Thread thread1 = <span class="keyword">new</span> MyThread(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">        Thread thread2 = <span class="keyword">new</span> MyThread(<span class="string">&quot;B&quot;</span>);</span><br><span class="line">        thread1.start();</span><br><span class="line">        thread2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-2实现Runnable"><a href="#2-2实现Runnable" class="headerlink" title="2.2实现Runnable"></a>2.2实现Runnable</h3><p>创建一个线程的第二种方法是创建一个实现Runnable接口的类.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyRunnable</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;创建线程: &quot;</span>+name+<span class="string">&quot; &quot;</span>+i);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Thread thread1 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> MyRunnable(<span class="string">&quot;ThreadA&quot;</span>));</span><br><span class="line">        Thread thread2 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> MyRunnable(<span class="string">&quot;ThreadB&quot;</span>));</span><br><span class="line"></span><br><span class="line">        thread1.start();</span><br><span class="line">        thread2.start();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-3通过Callable和Future创建线程"><a href="#2-3通过Callable和Future创建线程" class="headerlink" title="2.3通过Callable和Future创建线程"></a>2.3通过Callable和Future创建线程</h3><p>第三种方法是通过<code>Callable</code>和<code>Future</code>创建线程,前面两种都是无返回值,而这种方法适合获取线程的执行结构,基本步骤如下:</p>
<ol>
<li>创建<code>Callable</code>接口的实现类,并实现<code>call()</code>方法,该<code>call()</code>方法将作为线程执行体,并且有返回值</li>
<li>创建<code>Callable</code>实现类的实例,使用<code>FutureTask</code>类来包装Callable对象,该<code>FutureTask</code>对象封装了该 <code>Callable</code>对象的<code>call()</code>方法的返回值</li>
<li>使用<code>FutureTask</code>对象作为Thread对象的<code>target</code>创建并启动新线程</li>
<li>调用<code>FutureTask</code>对象的get()方法来获得子线程执行结束后的返回值</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyCallable</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; &quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> i;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        MyCallable myCallable = <span class="keyword">new</span> MyCallable();</span><br><span class="line">        FutureTask&lt;Integer&gt; ft = <span class="keyword">new</span> FutureTask&lt;&gt;(myCallable);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(ft, <span class="string">&quot;有返回值的线程&quot;</span>).start();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;子线程的返回值：&quot;</span> + ft.get());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ExecutionException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="线程的控制-常见方法"><a href="#线程的控制-常见方法" class="headerlink" title="线程的控制(常见方法)"></a>线程的控制(常见方法)</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/19/java8-Stream%E5%AD%A6%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="冯玮">
      <meta itemprop="description" content="以梦为马，明日天涯">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="冯玮的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/19/java8-Stream%E5%AD%A6%E4%B9%A0/" class="post-title-link" itemprop="url">java8 Stream学习</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-11-19 15:27:24 / 修改时间：15:27:48" itemprop="dateCreated datePublished" datetime="2020-11-19T15:27:24+08:00">2020-11-19</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="JDK8-–-Stream"><a href="#JDK8-–-Stream" class="headerlink" title="JDK8 – Stream"></a>JDK8 – Stream</h1><p><img src="https://img-blog.csdnimg.cn/2020110911333574.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L211X3dpbmQ=,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<h2 id="Stream能做什么"><a href="#Stream能做什么" class="headerlink" title="Stream能做什么?"></a>Stream能做什么?</h2><p>先贴上几个案例:</p>
<ol>
<li>从员工集合中筛选中salary大于8000的员工,并放置到新的集合里</li>
<li>统计员工的最高薪资,平均薪资,薪资之和</li>
<li>将员工按薪资从高到低排序,同样薪资者年龄小者在前</li>
<li>将员工按性别分类,将员工按性别和地区分类,将员工按薪资是否高于8000分为两部分</li>
</ol>
<p>用传统的遍历也是不难,但是需要大量的代码,跟stream相比高下立判</p>
<h2 id="1-stream概述"><a href="#1-stream概述" class="headerlink" title="1.stream概述"></a>1.stream概述</h2><p>java8 是一个非常成功的版本,这个版本新增的Stream,配合同版本出现的Lambda.给我们操作集合(Collection)提供了极大的遍历</p>
<p>那么什么是<code>Stream</code>?</p>
<blockquote>
<p><code>Stream</code>将要处理元素的集合看做一种流,再流的过程中,借助<code>Stream Api</code>对流中的元素进行操作,比如:筛选,排序,聚合等.</p>
</blockquote>
<p><code>Stream</code>可以由数组或集合创建,对流的操作分为两种</p>
<ol>
<li>中间操作,每次返回一个新的流,,可以有多个</li>
<li>终端操作,每个流只能进行一次终端操作,终端操作结束后流无法再次使用,终端操作会产生一个新的集合或值.</li>
</ol>
<p>另外,<code>stream</code>有几个特性:</p>
<ol>
<li><code>stream</code>不存储数据,而是按照特定的规则对数据进行计算,一般会输出结构</li>
<li><code>stream</code>不会改变数据源,通常情况下不会产生一个新的集合或一个值</li>
<li><code>stream</code>具有延迟执行特性,只有调用终端操作时,中间操作才会执行</li>
</ol>
<h2 id="2-stream-的创建"><a href="#2-stream-的创建" class="headerlink" title="2.stream 的创建"></a>2.stream 的创建</h2><p><code>stream</code>可以通过集合数据创建</p>
<ol>
<li><p>通过<code>java.unil.Collection.stream()</code>方法用集合创建流</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = Arrays.asList(<span class="string">&quot;str1&quot;</span>, <span class="string">&quot;str2&quot;</span>, <span class="string">&quot;str3&quot;</span>);</span><br><span class="line"><span class="comment">//创建顺序流</span></span><br><span class="line">Stream&lt;String&gt; stream = list.stream();</span><br><span class="line"><span class="comment">//创建并行流</span></span><br><span class="line">Stream&lt;String&gt; stringStream = list.parallelStream();</span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="2">
<li><p>使用<code>java.unil.Arrays.stream(T[] array)</code>方法用数组创建流</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>[] array = &#123;<span class="number">12</span>, <span class="number">23</span>, <span class="number">12</span>, <span class="number">44</span>&#125;;</span><br><span class="line">IntStream arrayStream = Arrays.stream(array);</span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="3">
<li><p>使用<code>Stream</code>的静态方法:<code>of(),iterate(),generate()</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;Integer&gt; integerStream = Stream.of(<span class="number">1</span>, <span class="number">23</span>, <span class="number">4</span>);</span><br><span class="line">Stream&lt;Integer&gt; limit = Stream.iterate(<span class="number">1</span>, x -&gt; x + <span class="number">4</span>).limit(<span class="number">10</span>);</span><br><span class="line">Stream&lt;Double&gt; doubleStream = Stream.generate(Math::random).limit(<span class="number">10</span>);</span><br><span class="line">doubleStream.forEach(System.out::println);</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p><code>stream</code>和<code>parallelStream</code>的简单区分:<code>stream</code>是顺序流,由主线程按顺序对流进行执行操作,而<code>parallelStream</code> 是并行流,内部以多线程并行执行的方式对流进行操作,但前提是流中的数据处理没有顺序要求,例如筛选集合中的奇数,两者的处理不同之处:</p>
<p><img src="https://img-blog.csdnimg.cn/20201106164400889.png" alt="在这里插入图片描述"></p>
<p>如果流中的数据量足够大,并行流通过<code>parallel()</code>把顺序转换成并行流:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Optional&lt;Integer&gt; findFirst = list.stream().parallel().filter(x-&gt;x&gt;<span class="number">6</span>).findFirst();</span><br></pre></td></tr></table></figure>

<h2 id="3-stream-的使用"><a href="#3-stream-的使用" class="headerlink" title="3.stream 的使用"></a>3.stream 的使用</h2><p>在使用<code>stream</code>之前.先理解一个概念:<code>Optional</code></p>
<blockquote>
<p><code>Optional</code>类是一个可以<code>null</code>的容器对象,如果存在则<code>isPresent()</code>方法返回<code>true</code>,调用<code>get()</code>方法会返回该对象</p>
</blockquote>
<p>案例中使用的员工类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Persion</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Integer salary;</span><br><span class="line">    <span class="keyword">private</span> String gender;</span><br><span class="line">    <span class="keyword">private</span> String area;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Persion</span><span class="params">(String name, Integer age, Integer salary, String gender, String area)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.salary = salary;</span><br><span class="line">        <span class="keyword">this</span>.gender = gender;</span><br><span class="line">        <span class="keyword">this</span>.area = area;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//省略get() set()</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>初始化员工</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Persion&gt; persions = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">persions.add(<span class="keyword">new</span> Persion(<span class="string">&quot;张三&quot;</span>,<span class="number">26</span>,<span class="number">8000</span>,<span class="string">&quot;男&quot;</span>,<span class="string">&quot;广州&quot;</span>));</span><br><span class="line">persions.add(<span class="keyword">new</span> Persion(<span class="string">&quot;李四&quot;</span>,<span class="number">23</span>,<span class="number">7600</span>,<span class="string">&quot;女&quot;</span>,<span class="string">&quot;天津&quot;</span>));</span><br><span class="line">persions.add(<span class="keyword">new</span> Persion(<span class="string">&quot;王五&quot;</span>,<span class="number">43</span>,<span class="number">8409</span>,<span class="string">&quot;男&quot;</span>,<span class="string">&quot;北京&quot;</span>));</span><br><span class="line">persions.add(<span class="keyword">new</span> Persion(<span class="string">&quot;赵六&quot;</span>,<span class="number">26</span>,<span class="number">9872</span>,<span class="string">&quot;女&quot;</span>,<span class="string">&quot;上海&quot;</span>));</span><br><span class="line">persions.add(<span class="keyword">new</span> Persion(<span class="string">&quot;周八&quot;</span>,<span class="number">34</span>,<span class="number">6504</span>,<span class="string">&quot;男&quot;</span>,<span class="string">&quot;广州&quot;</span>));</span><br></pre></td></tr></table></figure>

<h3 id="3-1-遍历-匹配-foreach-find-match"><a href="#3-1-遍历-匹配-foreach-find-match" class="headerlink" title="3.1 遍历/匹配(foreach/find.match)"></a>3.1 遍历/匹配(foreach/find.match)</h3><p><code>stream</code>也是支持类似集合的遍历和匹配元素的,只是<code>Stream</code>中的元素是以<code>Optional</code>类型存在的</p>
<p><code>Stream</code>的遍历和匹配是非常简单的</p>
<p><img src="https://img-blog.csdnimg.cn/2020110914450139.png" alt="在这里插入图片描述"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; list = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>);</span><br><span class="line">Stream&lt;Integer&gt; integerStream = list.stream().filter(x -&gt; x &gt; <span class="number">10</span>);</span><br><span class="line"><span class="comment">//遍历出所有符合条件的元素</span></span><br><span class="line">integerStream.forEach(System.out::println);</span><br><span class="line"><span class="comment">//匹配第一个筛选出来的元素</span></span><br><span class="line">Optional&lt;Integer&gt; first = list.stream().filter(x -&gt; x &gt; <span class="number">6</span>).findFirst();</span><br><span class="line">System.out.println(first);</span><br><span class="line"><span class="comment">//筛选出任意一个符合条件的元素</span></span><br><span class="line">Optional&lt;Integer&gt; any = list.stream().parallel().filter(x -&gt; x &gt; <span class="number">6</span>).findAny();</span><br><span class="line">System.out.println(any);</span><br><span class="line"><span class="comment">//是否包含特定条件的元素</span></span><br><span class="line"><span class="keyword">boolean</span> match = list.stream().anyMatch(x -&gt; x &lt; <span class="number">6</span>);</span><br><span class="line">System.out.println(match);</span><br><span class="line"><span class="comment">//是否所有的元素都符合条件</span></span><br><span class="line"><span class="keyword">boolean</span> b = list.stream().allMatch(x -&gt; x &lt; <span class="number">10</span>);</span><br><span class="line">System.out.println(b);</span><br></pre></td></tr></table></figure>



<h3 id="3-2-筛选-filter"><a href="#3-2-筛选-filter" class="headerlink" title="3.2 筛选(filter)"></a>3.2 筛选(filter)</h3><p>筛选,是按照一定的规则校验流中的元素,将符合条件的元素提取到新的流中的操作.</p>
<p><img src="https://img-blog.csdnimg.cn/20201109144706541.jpg" alt="stream的筛选"></p>
<p><strong>案例:筛选出<code>Integer</code>集合中大于7的元素,并打印出来</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; list = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>);</span><br><span class="line">list.stream().filter(n -&gt; n &gt; <span class="number">7</span>).forEach(System.out::println);</span><br></pre></td></tr></table></figure>

<p><strong>案例:筛选员工中工资高于8000的人,并形成新的集合</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Persion&gt; persions = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">persions.add(<span class="keyword">new</span> Persion(<span class="string">&quot;张三&quot;</span>,<span class="number">26</span>,<span class="number">8000</span>,<span class="string">&quot;男&quot;</span>,<span class="string">&quot;广州&quot;</span>));</span><br><span class="line">persions.add(<span class="keyword">new</span> Persion(<span class="string">&quot;李四&quot;</span>,<span class="number">23</span>,<span class="number">7600</span>,<span class="string">&quot;女&quot;</span>,<span class="string">&quot;天津&quot;</span>));</span><br><span class="line">persions.add(<span class="keyword">new</span> Persion(<span class="string">&quot;王五&quot;</span>,<span class="number">43</span>,<span class="number">8409</span>,<span class="string">&quot;男&quot;</span>,<span class="string">&quot;北京&quot;</span>));</span><br><span class="line">persions.add(<span class="keyword">new</span> Persion(<span class="string">&quot;赵六&quot;</span>,<span class="number">26</span>,<span class="number">9872</span>,<span class="string">&quot;女&quot;</span>,<span class="string">&quot;上海&quot;</span>));</span><br><span class="line">persions.add(<span class="keyword">new</span> Persion(<span class="string">&quot;周八&quot;</span>,<span class="number">34</span>,<span class="number">6504</span>,<span class="string">&quot;男&quot;</span>,<span class="string">&quot;广州&quot;</span>));</span><br><span class="line">List&lt;Persion&gt; list1 = persions.stream().filter(persion -&gt; persion.getSalary() &gt; <span class="number">8000</span>).collect(Collectors.toList());</span><br><span class="line">System.out.println(list1);</span><br></pre></td></tr></table></figure>



<h3 id="3-3聚合-max-min-count"><a href="#3-3聚合-max-min-count" class="headerlink" title="3.3聚合(max/min/count)"></a>3.3聚合(max/min/count)</h3><p><code>max</code>,<code>min</code>,<code>count</code>这些词在sql中经常使用,现在stream中也 引入了这些概念和用法,极大的程度方便了我们对集合.数组的统计工作</p>
<p><img src="D:\工作学习\设计模式图片\steam聚合.png" alt="在这里插入图片描述"></p>
<p><strong>案例:获取<code>String</code>集合中最长的元素</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; stringList = Arrays.asList(<span class="string">&quot;java&quot;</span>, <span class="string">&quot;net&quot;</span>, <span class="string">&quot;c#&quot;</span>, <span class="string">&quot;python&quot;</span>, <span class="string">&quot;php&quot;</span>);</span><br><span class="line"><span class="comment">//输入最长的字符串</span></span><br><span class="line">Optional&lt;String&gt; max1 = stringList.stream().max(Comparator.comparing(String::length));</span><br><span class="line">System.out.println(max1);<span class="comment">//输出结果  python</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//输出最短的字符串</span></span><br><span class="line">Optional&lt;String&gt; max = stringList.stream().max(<span class="keyword">new</span> Comparator&lt;String&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(String o1, String o2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> o2.length() - o1.length(); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">System.out.println(max);<span class="comment">//输出 c#</span></span><br></pre></td></tr></table></figure>

<p><strong>案例:获取<code>Integer</code>集合中的最大值</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; integerList = Arrays.asList(<span class="number">100</span>, <span class="number">200</span>, <span class="number">120</span>, <span class="number">110</span>, <span class="number">99</span>, <span class="number">89</span>);</span><br><span class="line">Optional&lt;Integer&gt; max = integerList.stream().max(Integer::compareTo);</span><br><span class="line">System.out.println(max);</span><br><span class="line"><span class="comment">//自定义比较</span></span><br><span class="line">Optional&lt;Integer&gt; max1 = integerList.stream().max(<span class="keyword">new</span> Comparator&lt;Integer&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Integer o1, Integer o2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> o1.compareTo(o2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>案例:获取员工工资最高的人</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Persion&gt; persions = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">persions.add(<span class="keyword">new</span> Persion(<span class="string">&quot;张三&quot;</span>, <span class="number">26</span>, <span class="number">8000</span>, <span class="string">&quot;男&quot;</span>, <span class="string">&quot;广州&quot;</span>));</span><br><span class="line">persions.add(<span class="keyword">new</span> Persion(<span class="string">&quot;李四&quot;</span>, <span class="number">23</span>, <span class="number">7600</span>, <span class="string">&quot;女&quot;</span>, <span class="string">&quot;天津&quot;</span>));</span><br><span class="line">persions.add(<span class="keyword">new</span> Persion(<span class="string">&quot;王五&quot;</span>, <span class="number">43</span>, <span class="number">8409</span>, <span class="string">&quot;男&quot;</span>, <span class="string">&quot;北京&quot;</span>));</span><br><span class="line">persions.add(<span class="keyword">new</span> Persion(<span class="string">&quot;赵六&quot;</span>, <span class="number">26</span>, <span class="number">9872</span>, <span class="string">&quot;女&quot;</span>, <span class="string">&quot;上海&quot;</span>));</span><br><span class="line">persions.add(<span class="keyword">new</span> Persion(<span class="string">&quot;周八&quot;</span>, <span class="number">34</span>, <span class="number">6504</span>, <span class="string">&quot;男&quot;</span>, <span class="string">&quot;广州&quot;</span>));</span><br><span class="line">Optional&lt;Persion&gt; max2 =  persions.stream().max(Comparator.comparingInt(Persion::getSalary));</span><br><span class="line">System.out.println(max2);</span><br></pre></td></tr></table></figure>

<p><strong>案例:计算<code>Integer</code>集合中大于6的元素个数</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; integerList = Arrays.asList(<span class="number">100</span>, <span class="number">200</span>, <span class="number">120</span>, <span class="number">110</span>, <span class="number">99</span>, <span class="number">89</span>);</span><br><span class="line"><span class="keyword">long</span> count = integerList.stream().filter(n -&gt; n &gt; <span class="number">6</span>).count();</span><br><span class="line">System.out.println(<span class="string">&quot;count=&quot;</span>+count);</span><br></pre></td></tr></table></figure>



<h3 id="3-4映射-map-flatMap"><a href="#3-4映射-map-flatMap" class="headerlink" title="3.4映射(map/flatMap)"></a>3.4映射(map/flatMap)</h3><p>映射,可以将一个流的元素按照一定的映射规则映射到另一个流中,分别为<code>map</code>,<code>flatMap</code></p>
<ul>
<li><code>map</code>:接受一个函数作为参数,该函数会被应用到每个元素上,并将其英社称一个新的元素</li>
<li><code>flatMap</code>:接收一个函数作为参数,将流中的每一个值都换成另一个流,然后把所有的流连接成一个流</li>
</ul>
<p><img src="D:\工作学习\设计模式图片\stream-map图解.jpg" alt="在这里插入图片描述"></p>
<p><img src="D:\工作学习\设计模式图片\stream-flatmap图解.jpg" alt="在这里插入图片描述"></p>
<p><strong>案例:英文字符串数组的元素全部改为大写,整个数组的每个元素+3</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; stringList = Arrays.asList(<span class="string">&quot;java&quot;</span>, <span class="string">&quot;net&quot;</span>, <span class="string">&quot;c++&quot;</span>, <span class="string">&quot;python&quot;</span>, <span class="string">&quot;php&quot;</span>);</span><br><span class="line"><span class="comment">//首字母大写</span></span><br><span class="line">List&lt;String&gt; collect = stringList.stream().map(str -&gt; str.substring(<span class="number">0</span>, <span class="number">1</span>).toUpperCase() + str.substring(<span class="number">1</span>)).collect(Collectors.toList());</span><br><span class="line">System.out.println(collect);</span><br><span class="line">List&lt;Integer&gt; integerList = Arrays.asList(<span class="number">100</span>, <span class="number">200</span>, <span class="number">120</span>, <span class="number">110</span>, <span class="number">99</span>, <span class="number">89</span>);</span><br><span class="line"><span class="comment">//每个元素+3</span></span><br><span class="line">List&lt;Integer&gt; collect1 = integerList.stream().map(n -&gt; n + <span class="number">3</span>).collect(Collectors.toList());</span><br><span class="line">System.out.println(collect1);</span><br></pre></td></tr></table></figure>

<p><strong>将两个字符串组合合并成一个新的字符串数组</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; stringList = Arrays.asList(<span class="string">&quot;1,2,4,5&quot;</span>, <span class="string">&quot;ab,cd,ef&quot;</span>);</span><br><span class="line">List&lt;String&gt; collect = stringList.stream().flatMap(str -&gt; &#123;</span><br><span class="line">    String[] split = str.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">    Stream&lt;String&gt; split1 = Stream.of(split);</span><br><span class="line">    <span class="keyword">return</span> split1;</span><br><span class="line">&#125;).collect(Collectors.toList());</span><br><span class="line">System.out.println(stringList);</span><br><span class="line">System.out.println(collect);</span><br></pre></td></tr></table></figure>



<h3 id="3-5归约-reduce"><a href="#3-5归约-reduce" class="headerlink" title="3.5归约(reduce)"></a>3.5归约(reduce)</h3><p>规约,也成缩减,顾名思义,是把一个流缩减成一个值,能实现对集合求和,求乘机和最值的操作</p>
<p><strong>案例一：求<code>Integer</code>集合的元素之和、乘积和最大值</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; integerList = Arrays.asList(<span class="number">2</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">56</span>, <span class="number">2</span>, <span class="number">4</span>);</span><br><span class="line"><span class="comment">//求和</span></span><br><span class="line">Optional&lt;Integer&gt; sum = integerList.stream().reduce((x, y) -&gt; x + y);<span class="comment">//多个参数需要在箭头的左边加(括号)</span></span><br><span class="line">System.out.println(sum);</span><br><span class="line">Integer sum1 = integerList.stream().reduce(<span class="number">0</span>, Integer::sum);</span><br><span class="line">System.out.println(sum1);</span><br><span class="line">Optional&lt;Integer&gt; sum2 = integerList.stream().reduce(Integer::sum);</span><br><span class="line">System.out.println(sum2);</span><br><span class="line"><span class="comment">//求乘积</span></span><br><span class="line">Optional&lt;Integer&gt; d = integerList.stream().reduce((x, y) -&gt; x * y);</span><br><span class="line">System.out.println(d);</span><br><span class="line"><span class="comment">//求最大值</span></span><br><span class="line">Optional&lt;Integer&gt; max1 = integerList.stream().reduce((x, y) -&gt; x &gt; y ? x : y);</span><br><span class="line">System.out.println(max1);</span><br><span class="line">Optional&lt;Integer&gt; max2 = integerList.stream().reduce(Integer::max);</span><br><span class="line">System.out.println(max2);</span><br></pre></td></tr></table></figure>

<p><strong>案例二：求所有员工的工资之和和最高工资</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Persion&gt; persions = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">persions.add(<span class="keyword">new</span> Persion(<span class="string">&quot;张三&quot;</span>, <span class="number">26</span>, <span class="number">8000</span>, <span class="string">&quot;男&quot;</span>, <span class="string">&quot;广州&quot;</span>));</span><br><span class="line">persions.add(<span class="keyword">new</span> Persion(<span class="string">&quot;李四&quot;</span>, <span class="number">23</span>, <span class="number">7600</span>, <span class="string">&quot;女&quot;</span>, <span class="string">&quot;天津&quot;</span>));</span><br><span class="line">persions.add(<span class="keyword">new</span> Persion(<span class="string">&quot;王五&quot;</span>, <span class="number">43</span>, <span class="number">8409</span>, <span class="string">&quot;男&quot;</span>, <span class="string">&quot;北京&quot;</span>));</span><br><span class="line">persions.add(<span class="keyword">new</span> Persion(<span class="string">&quot;赵六&quot;</span>, <span class="number">26</span>, <span class="number">9872</span>, <span class="string">&quot;女&quot;</span>, <span class="string">&quot;上海&quot;</span>));</span><br><span class="line">persions.add(<span class="keyword">new</span> Persion(<span class="string">&quot;周八&quot;</span>, <span class="number">34</span>, <span class="number">6504</span>, <span class="string">&quot;男&quot;</span>, <span class="string">&quot;广州&quot;</span>));</span><br><span class="line"><span class="comment">//获取所有的工资</span></span><br><span class="line">List&lt;Integer&gt; salary = persions.stream().map(persion -&gt; persion.getSalary()).collect(Collectors.toList());</span><br><span class="line"><span class="comment">//工资之和</span></span><br><span class="line">Optional&lt;Integer&gt; sum1 = salary.stream().reduce((x, y) -&gt; x + y);</span><br><span class="line">System.out.println(sum1);</span><br><span class="line">Integer sum2 = persions.stream().reduce(<span class="number">0</span>, (sum, p) -&gt; sum = sum + p.getSalary(), (x, y) -&gt; x + y);</span><br><span class="line">System.out.println(sum2);</span><br><span class="line">Integer sum3 = persions.stream().reduce(<span class="number">0</span>, (sum, p) -&gt; sum + p.getSalary(), Integer::sum);</span><br><span class="line">System.out.println(sum3);</span><br><span class="line"><span class="comment">//求最高工资</span></span><br><span class="line">Integer max1 = persions.stream().reduce(<span class="number">0</span>, (max, p) -&gt; max &gt; p.getSalary() ? max : p.getSalary(), Integer::max);</span><br><span class="line">System.out.println(max1);</span><br><span class="line">Integer max2 = persions.stream().reduce(<span class="number">0</span>, (max, p) -&gt; max &gt; p.getSalary() ? max : p.getSalary(), (x, y) -&gt; x &gt; y ? x : y);</span><br><span class="line">System.out.println(max2);</span><br></pre></td></tr></table></figure>

<h3 id="3-6收集-collect"><a href="#3-6收集-collect" class="headerlink" title="3.6收集(collect)"></a>3.6收集(collect)</h3><p><code>collect</code> ,收集,可以说是内容繁多,功能最丰富的部分了,从字面上理解,就是把一个流收集起来,最终可以收集成一个值也可以手机恒一个新的集合.</p>
<blockquote>
<p><code>collect</code>主要依赖<code>java.unil.stream.Collectors</code>类内置的静态方法.</p>
</blockquote>
<h4 id="3-6-1归集-toSet-toList-toMap"><a href="#3-6-1归集-toSet-toList-toMap" class="headerlink" title="3.6.1归集(toSet,toList,toMap)"></a>3.6.1归集(toSet,toList,toMap)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Persion&gt; persions = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">persions.add(<span class="keyword">new</span> Persion(<span class="string">&quot;张三&quot;</span>, <span class="number">26</span>, <span class="number">8000</span>, <span class="string">&quot;男&quot;</span>, <span class="string">&quot;广州&quot;</span>));</span><br><span class="line">persions.add(<span class="keyword">new</span> Persion(<span class="string">&quot;李四&quot;</span>, <span class="number">23</span>, <span class="number">7600</span>, <span class="string">&quot;女&quot;</span>, <span class="string">&quot;天津&quot;</span>));</span><br><span class="line">persions.add(<span class="keyword">new</span> Persion(<span class="string">&quot;王五&quot;</span>, <span class="number">43</span>, <span class="number">8409</span>, <span class="string">&quot;男&quot;</span>, <span class="string">&quot;北京&quot;</span>));</span><br><span class="line">persions.add(<span class="keyword">new</span> Persion(<span class="string">&quot;赵六&quot;</span>, <span class="number">26</span>, <span class="number">9872</span>, <span class="string">&quot;女&quot;</span>, <span class="string">&quot;上海&quot;</span>));</span><br><span class="line">persions.add(<span class="keyword">new</span> Persion(<span class="string">&quot;周八&quot;</span>, <span class="number">34</span>, <span class="number">6504</span>, <span class="string">&quot;男&quot;</span>, <span class="string">&quot;广州&quot;</span>));</span><br><span class="line"><span class="comment">//获取所有的工资</span></span><br><span class="line">Set&lt;Integer&gt; salary = persions.stream().map(persion -&gt; persion.getSalary()).collect(Collectors.toSet());</span><br><span class="line"><span class="comment">//toMap</span></span><br><span class="line">Map&lt;Integer, String&gt; collect = persions.stream()</span><br><span class="line">        .filter(p -&gt; p.getSalary() &gt; <span class="number">8000</span>)</span><br><span class="line">        .collect(Collectors.toMap(Persion::getSalary,Persion::getName));</span><br><span class="line">System.out.println(collect);<span class="comment">//结果:&#123;9872=赵六, 8409=王五&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-6-2统计-count-averaging"><a href="#3-6-2统计-count-averaging" class="headerlink" title="3.6.2统计(count/averaging)"></a>3.6.2统计(count/averaging)</h4><p><code>Collectors</code>提供了一些列用于数据统计的静态方法;</p>
<ul>
<li>计数:<code>count</code></li>
<li>平均值:<code>averagingInt</code>,<code>averagingLong</code>,<code>averagingDouble</code></li>
<li>最值:<code>maxBy</code>,<code>minBy</code></li>
<li>求和:<code>summingInt</code>,<code>summingLong</code>,<code>summingDouble</code></li>
<li>统计以上所有:<code>summarizingInt</code>,<code>summarizingLong</code>,<code>summarizingDouble</code></li>
</ul>
<p><strong>案例:统计所有员工人数,平均工资,工资总额,最高工资</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Persion&gt; persions = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">persions.add(<span class="keyword">new</span> Persion(<span class="string">&quot;张三&quot;</span>, <span class="number">26</span>, <span class="number">8000</span>, <span class="string">&quot;男&quot;</span>, <span class="string">&quot;广州&quot;</span>));</span><br><span class="line">persions.add(<span class="keyword">new</span> Persion(<span class="string">&quot;李四&quot;</span>, <span class="number">23</span>, <span class="number">7600</span>, <span class="string">&quot;女&quot;</span>, <span class="string">&quot;天津&quot;</span>));</span><br><span class="line">persions.add(<span class="keyword">new</span> Persion(<span class="string">&quot;王五&quot;</span>, <span class="number">43</span>, <span class="number">8409</span>, <span class="string">&quot;男&quot;</span>, <span class="string">&quot;北京&quot;</span>));</span><br><span class="line">persions.add(<span class="keyword">new</span> Persion(<span class="string">&quot;赵六&quot;</span>, <span class="number">26</span>, <span class="number">9872</span>, <span class="string">&quot;女&quot;</span>, <span class="string">&quot;上海&quot;</span>));</span><br><span class="line">persions.add(<span class="keyword">new</span> Persion(<span class="string">&quot;周八&quot;</span>, <span class="number">34</span>, <span class="number">6504</span>, <span class="string">&quot;男&quot;</span>, <span class="string">&quot;广州&quot;</span>));</span><br><span class="line"><span class="comment">//员工人数</span></span><br><span class="line"><span class="keyword">long</span> count = persions.stream().count();</span><br><span class="line">System.out.println(<span class="string">&quot;员工人数: &quot;</span> + count);</span><br><span class="line"><span class="comment">//平均工资</span></span><br><span class="line">Double collect = persions.stream().collect(Collectors.averagingDouble(Persion::getSalary));</span><br><span class="line">System.out.println(<span class="string">&quot;平均工资: &quot;</span>+collect);</span><br><span class="line"><span class="comment">//最高工资</span></span><br><span class="line">Optional&lt;Integer&gt; max = persions.stream().map(persion -&gt; persion.getSalary()).max(Integer::compareTo);</span><br><span class="line">System.out.println(<span class="string">&quot;最高工资: &quot;</span>+max.get());</span><br><span class="line"><span class="comment">//工资之和</span></span><br><span class="line">Integer collect1 = persions.stream().collect(Collectors.summingInt(Persion::getSalary));</span><br><span class="line">System.out.println(<span class="string">&quot;工资之和: &quot;</span>+collect1);</span><br><span class="line"><span class="comment">//一次性统计所有信息</span></span><br><span class="line">DoubleSummaryStatistics collect2 = persions.stream().collect(Collectors.summarizingDouble(Persion::getSalary));</span><br><span class="line">System.out.println(<span class="string">&quot;一次性统计所有信息: &quot;</span>+collect2);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">员工人数: <span class="number">5</span></span><br><span class="line">平均工资: <span class="number">8077.0</span></span><br><span class="line">最高工资: <span class="number">9872</span></span><br><span class="line">工资之和: <span class="number">40385</span></span><br><span class="line">一次性统计所有信息: DoubleSummaryStatistics&#123;count=<span class="number">5</span>, sum=<span class="number">40385.000000</span>, min=<span class="number">6504.000000</span>, average=<span class="number">8077.000000</span>, max=<span class="number">9872.000000</span>&#125;</span><br></pre></td></tr></table></figure>



<h4 id="3-6-3分组-groupingBy"><a href="#3-6-3分组-groupingBy" class="headerlink" title="3.6.3分组(groupingBy)"></a>3.6.3分组(groupingBy)</h4><ul>
<li>分区:将<code>stream</code>按条件分为两个<code>map</code>,比如员工按薪资是否高于8000分为两个部分</li>
<li>分组:将集合分为多个<code>Map</code>,比如员工按性别分组,有单级分组和多级分组</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/20201109145807450.png#pic_left" alt="在这里插入图片描述"></p>
<p><strong>案例:将员工按薪资是否高于8000分为两个部分;将员工按性别和地区分组</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//将员工按照薪资8000进行分组</span></span><br><span class="line">Map&lt;Boolean, List&lt;Persion&gt;&gt; collect = persions.stream().collect(Collectors.partitioningBy(persion -&gt; persion.getSalary() &gt; <span class="number">8000</span>));</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//结果输出</span></span><br><span class="line">&#123;<span class="keyword">false</span>=[Persion&#123;name=<span class="string">&#x27;张三&#x27;</span>, age=<span class="number">26</span>, salary=<span class="number">8000</span>, gender=<span class="string">&#x27;男&#x27;</span>, area=<span class="string">&#x27;广州&#x27;</span>&#125;, Persion&#123;name=<span class="string">&#x27;李四&#x27;</span>, age=<span class="number">23</span>, salary=<span class="number">7600</span>, gender=<span class="string">&#x27;女&#x27;</span>, area=<span class="string">&#x27;天津&#x27;</span>&#125;, Persion&#123;name=<span class="string">&#x27;周八&#x27;</span>, age=<span class="number">34</span>, salary=<span class="number">6504</span>, gender=<span class="string">&#x27;男&#x27;</span>, area=<span class="string">&#x27;广州&#x27;</span>&#125;], </span><br><span class="line"> <span class="keyword">true</span>=[Persion&#123;name=<span class="string">&#x27;王五&#x27;</span>, age=<span class="number">43</span>, salary=<span class="number">8409</span>, gender=<span class="string">&#x27;男&#x27;</span>, area=<span class="string">&#x27;北京&#x27;</span>&#125;, Persion&#123;name=<span class="string">&#x27;赵六&#x27;</span>, age=<span class="number">26</span>, salary=<span class="number">9872</span>, gender=<span class="string">&#x27;女&#x27;</span>, area=<span class="string">&#x27;上海&#x27;</span>&#125;]&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//按照员工的性别和地区进行分组</span></span><br><span class="line">Map&lt;String, Map&lt;String, List&lt;Persion&gt;&gt;&gt; collect1 = persions.stream().collect(Collectors.groupingBy(persion -&gt; persion.getGender(),</span><br><span class="line">        Collectors.groupingBy(persion-&gt;persion.getArea())));</span><br><span class="line">System.out.println(collect1);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//结果输出</span></span><br><span class="line">&#123;女=&#123;上海=[Persion&#123;name=<span class="string">&#x27;赵六&#x27;</span>, age=<span class="number">26</span>, salary=<span class="number">9872</span>, gender=<span class="string">&#x27;女&#x27;</span>, area=<span class="string">&#x27;上海&#x27;</span>&#125;], 天津=[Persion&#123;name=<span class="string">&#x27;李四&#x27;</span>, age=<span class="number">23</span>, salary=<span class="number">7600</span>, gender=<span class="string">&#x27;女&#x27;</span>, area=<span class="string">&#x27;天津&#x27;</span>&#125;]&#125;, 男=&#123;广州=[Persion&#123;name=<span class="string">&#x27;张三&#x27;</span>, age=<span class="number">26</span>, salary=<span class="number">8000</span>, gender=<span class="string">&#x27;男&#x27;</span>, area=<span class="string">&#x27;广州&#x27;</span>&#125;, Persion&#123;name=<span class="string">&#x27;周八&#x27;</span>, age=<span class="number">34</span>, salary=<span class="number">6504</span>, gender=<span class="string">&#x27;男&#x27;</span>, area=<span class="string">&#x27;广州&#x27;</span>&#125;], 北京=[Persion&#123;name=<span class="string">&#x27;王五&#x27;</span>, age=<span class="number">43</span>, salary=<span class="number">8409</span>, gender=<span class="string">&#x27;男&#x27;</span>, area=<span class="string">&#x27;北京&#x27;</span>&#125;]&#125;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="3-6-4接合-joining"><a href="#3-6-4接合-joining" class="headerlink" title="3.6.4接合(joining)"></a>3.6.4接合(joining)</h4><p><code>joining</code>可以将<code>stream</code>中元素用特定的连接符(没有的话,则直接连接)连接成一个字符串</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//将员工的名字连接成一个字符串</span></span><br><span class="line"> List&lt;String&gt; names = persions.stream().map(persion -&gt;  persion.getName()).collect(Collectors.toList());</span><br><span class="line"> String nameStr = names.stream().collect(Collectors.joining(<span class="string">&quot;-&quot;</span>));</span><br><span class="line"> System.out.println(nameStr);</span><br><span class="line"><span class="comment">//打印结果: 张三-李四-王五-赵六-周八</span></span><br></pre></td></tr></table></figure>



<h4 id="3-6-5归约-reducing"><a href="#3-6-5归约-reducing" class="headerlink" title="3.6.5归约(reducing)"></a>3.6.5归约(reducing)</h4><p><code>Collectors</code>类提供的<code>reducing</code>方法,相比于<code>stream</code>本身的<code>reduce</code>方法,增加了对自定义归约的支持.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Integer sum = persions.stream().collect(Collectors.reducing(<span class="number">0</span>, Persion::getSalary, Integer::sum));</span><br><span class="line">System.out.println(sum);</span><br><span class="line"><span class="comment">//stream的reduce</span></span><br><span class="line">Integer sum = persions.stream().map(Persion::getSalary).reduce(<span class="number">0</span>, Integer::sum);</span><br><span class="line"></span><br><span class="line">BigDecimal reduce = bigDecimals.stream().reduce(BigDecimal.ZERO, BigDecimal::add);</span><br><span class="line">System.out.println(reduce);</span><br></pre></td></tr></table></figure>



<h3 id="3-7排序-sorted"><a href="#3-7排序-sorted" class="headerlink" title="3.7排序(sorted)"></a>3.7排序(sorted)</h3><p><code>sorted</code>中间操作,有两种排序:</p>
<ul>
<li><code>sorted()</code>:自然排序,流中元素需实现<code>Comparable</code>接口</li>
<li><code>sorted(Comparator com)</code>:<code>Compatator</code>自定义排序</li>
</ul>
<p><strong>案例:将员工工资由高到低(工资一样则按年龄有大到小排序)</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> List&lt;Persion&gt; persions = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"> persions.add(<span class="keyword">new</span> Persion(<span class="string">&quot;张三&quot;</span>, <span class="number">26</span>, <span class="number">8000</span>, <span class="string">&quot;男&quot;</span>, <span class="string">&quot;广州&quot;</span>));</span><br><span class="line"> persions.add(<span class="keyword">new</span> Persion(<span class="string">&quot;李四&quot;</span>, <span class="number">23</span>, <span class="number">7600</span>, <span class="string">&quot;女&quot;</span>, <span class="string">&quot;天津&quot;</span>));</span><br><span class="line"> persions.add(<span class="keyword">new</span> Persion(<span class="string">&quot;王五&quot;</span>, <span class="number">43</span>, <span class="number">8409</span>, <span class="string">&quot;男&quot;</span>, <span class="string">&quot;北京&quot;</span>));</span><br><span class="line"> persions.add(<span class="keyword">new</span> Persion(<span class="string">&quot;赵六&quot;</span>, <span class="number">40</span>, <span class="number">8000</span>, <span class="string">&quot;女&quot;</span>, <span class="string">&quot;上海&quot;</span>));</span><br><span class="line"> persions.add(<span class="keyword">new</span> Persion(<span class="string">&quot;周八&quot;</span>, <span class="number">34</span>, <span class="number">6504</span>, <span class="string">&quot;男&quot;</span>, <span class="string">&quot;广州&quot;</span>));</span><br><span class="line"><span class="comment">//将员工按照薪水高低进行排序(薪资一样,按照年龄排)</span></span><br><span class="line">List&lt;Persion&gt; collect = persions.stream().sorted(Comparator.comparingInt(Persion::getSalary).thenComparing(Persion::getAge)).collect(Collectors.toList());</span><br><span class="line">System.out.println(collect);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[Persion&#123;name=<span class="string">&#x27;周八&#x27;</span>, age=<span class="number">34</span>, salary=<span class="number">6504</span>, gender=<span class="string">&#x27;男&#x27;</span>, area=<span class="string">&#x27;广州&#x27;</span>&#125;, Persion&#123;name=<span class="string">&#x27;李四&#x27;</span>, age=<span class="number">23</span>, salary=<span class="number">7600</span>, gender=<span class="string">&#x27;女&#x27;</span>, area=<span class="string">&#x27;天津&#x27;</span>&#125;, Persion&#123;name=<span class="string">&#x27;张三&#x27;</span>, age=<span class="number">26</span>, salary=<span class="number">8000</span>, gender=<span class="string">&#x27;男&#x27;</span>, area=<span class="string">&#x27;广州&#x27;</span>&#125;, Persion&#123;name=<span class="string">&#x27;赵六&#x27;</span>, age=<span class="number">40</span>, salary=<span class="number">8000</span>, gender=<span class="string">&#x27;女&#x27;</span>, area=<span class="string">&#x27;上海&#x27;</span>&#125;, Persion&#123;name=<span class="string">&#x27;王五&#x27;</span>, age=<span class="number">43</span>, salary=<span class="number">8409</span>, gender=<span class="string">&#x27;男&#x27;</span>, area=<span class="string">&#x27;北京&#x27;</span>&#125;]</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="3-8提取-组合"><a href="#3-8提取-组合" class="headerlink" title="3.8提取/组合"></a>3.8提取/组合</h3><p>流也可以进行合并,去重,限制,跳过等操作</p>
<p><img src="https://img-blog.csdnimg.cn/20201109150012790.jpg" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/20201109150001270.jpg" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/20201109145946301.jpg" alt="在这里插入图片描述"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> String[] str1 = &#123;<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>, <span class="string">&quot;D&quot;</span>&#125;;</span><br><span class="line"> String[] str2 = &#123;<span class="string">&quot;C&quot;</span>, <span class="string">&quot;D&quot;</span>, <span class="string">&quot;E&quot;</span>, <span class="string">&quot;F&quot;</span>&#125;;</span><br><span class="line"> Stream&lt;String&gt; stream1 = Stream.of(str1);</span><br><span class="line"> Stream&lt;String&gt; stream2 = Stream.of(str2);</span><br><span class="line">  <span class="comment">//合并流</span></span><br><span class="line"> List&lt;String&gt; collect1 = Stream.concat(stream1, stream2).collect(Collectors.toList());</span><br><span class="line"> System.out.println(collect1);</span><br><span class="line"><span class="comment">//[A, B, C, D, C, D, E, F]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//去重</span></span><br><span class="line">List&lt;String&gt; collect2 = Stream.concat(stream1, stream2).distinct().collect(Collectors.toList());</span><br><span class="line">System.out.println(collect2);</span><br><span class="line"><span class="comment">//[A, B, C, D, E, F]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//限制流</span></span><br><span class="line">List&lt;Integer&gt; collect1 = Stream.iterate(<span class="number">1</span>, x -&gt; x + <span class="number">3</span>).limit(<span class="number">3</span>).collect(Collectors.toList());</span><br><span class="line">System.out.println(collect1);</span><br><span class="line"><span class="comment">//[1, 4, 7]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//跳过前n个数据</span></span><br><span class="line">List&lt;Integer&gt; collect3 = Stream.iterate(<span class="number">1</span>, x -&gt; x + <span class="number">3</span>).skip(<span class="number">3</span>).limit(<span class="number">10</span>).collect(Collectors.toList());</span><br><span class="line">System.out.println(collect3);</span><br><span class="line"><span class="comment">//[10, 13, 16, 19, 22, 25, 28, 31, 34, 37]</span></span><br></pre></td></tr></table></figure>



<h2 id="4-Stream源码解读"><a href="#4-Stream源码解读" class="headerlink" title="4.Stream源码解读"></a>4.Stream源码解读</h2><p><strong>想要了解源码,首先要了解这些类是什么</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">BiConsumer.java</span><br><span class="line">BiFunction.java</span><br><span class="line">BinaryOperator.java</span><br><span class="line">BiPredicate.java</span><br><span class="line">BooleanSupplier.java</span><br><span class="line">Consumer.java</span><br><span class="line">DoubleBinaryOperator.java</span><br><span class="line">DoubleConsumer.java</span><br><span class="line">DoubleFunction.java</span><br><span class="line">DoublePredicate.java</span><br><span class="line">DoubleSupplier.java</span><br><span class="line">DoubleToIntFunction.java</span><br><span class="line">DoubleToLongFunction.java</span><br><span class="line">DoubleUnaryOperator.java</span><br><span class="line">Function.java</span><br><span class="line">IntBinaryOperator.java</span><br><span class="line">IntConsumer.java</span><br><span class="line">IntFunction.java</span><br><span class="line">IntPredicate.java</span><br><span class="line">IntSupplier.java</span><br><span class="line">IntToDoubleFunction.java</span><br><span class="line">IntToLongFunction.java</span><br><span class="line">IntUnaryOperator.java</span><br><span class="line">LongBinaryOperator.java</span><br><span class="line">LongConsumer.java</span><br><span class="line">LongFunction.java</span><br><span class="line">LongPredicate.java</span><br><span class="line">LongSupplier.java</span><br><span class="line">LongToDoubleFunction.java</span><br><span class="line">LongToIntFunction.java</span><br><span class="line">LongUnaryOperator.java</span><br><span class="line">ObjDoubleConsumer.java</span><br><span class="line">ObjIntConsumer.java</span><br><span class="line">ObjLongConsumer.java</span><br><span class="line"><span class="keyword">package</span>-info.java</span><br><span class="line">Predicate.java</span><br><span class="line">Supplier.java</span><br><span class="line">ToDoubleBiFunction.java</span><br><span class="line">ToDoubleFunction.java</span><br><span class="line">ToIntBiFunction.java</span><br><span class="line">ToIntFunction.java</span><br><span class="line">ToLongBiFunction.java</span><br><span class="line">ToLongFunction.java</span><br><span class="line">UnaryOperator.java</span><br></pre></td></tr></table></figure>




      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/12/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="冯玮">
      <meta itemprop="description" content="以梦为马，明日天涯">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="冯玮的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/12/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F/" class="post-title-link" itemprop="url">设计模式-装饰器模式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-11-12 15:31:47 / 修改时间：15:32:45" itemprop="dateCreated datePublished" datetime="2020-11-12T15:31:47+08:00">2020-11-12</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="装饰器模式"><a href="#装饰器模式" class="headerlink" title="装饰器模式"></a>装饰器模式</h1><h2 id="一、装饰器模式介紹"><a href="#一、装饰器模式介紹" class="headerlink" title="一、装饰器模式介紹"></a>一、装饰器模式介紹</h2><p>装饰器模式的核心是在不改原有类的基础上给类新增功能，不改变原有类，可能有的小伙伴就会想到继承、AOP切面，当然这些方式都可以实现，但是使用装饰器模式会是另一种思路更为灵活，可以避免继承导致子类过多。也可以避免AOP带来的复杂性；</p>
<p>很多熟悉的场景用到装饰器模式：</p>
<p><code>new BuffereReader(new FileReader(&quot;&quot;));</code>这段代码你是否熟悉。相信学习java到字节流，字符流。文件流的内容时都见到了这样的代码，一层嵌套一层，一层嵌套一层，字节流转字符流等等，而这样的方式使用就是装饰器的一种体现</p>
<h2 id="二、案例场景模拟"><a href="#二、案例场景模拟" class="headerlink" title="二、案例场景模拟"></a>二、案例场景模拟</h2><p><img src="https://bugstack.cn/assets/images/2020/itstack-demo-design-9-02.png" alt="场景模拟；单点登录功能扩展"></p>
<p><strong>在本案例中我们模拟一个单点登录功能扩充的场景</strong></p>
<p>谁也业务的逐渐发展，从刚开始的内部ERP系统仅仅需要判断用户验证即可，验证成功以后，访问所有的资源，业务的扩展之后，团队里面出现专门的运营人员，营销人员，数据藤原，每个人的对与ERP的使用需求不同，并且为了保证数据的安全性，不会让每个用户都有最高的权限</p>
<p>那么以往使用<code>sso</code>是一个组件化通用的服务，不能在里面添加需要的用户访问验证功能，这个时候我们就可以使用装饰器模式，扩展原有的单点登录系统，但同时也要保证原有功能不够影响，可以继续使用</p>
<h3 id="1-案例模拟工程"><a href="#1-案例模拟工程" class="headerlink" title="1.案例模拟工程"></a>1.案例模拟工程</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">itstack-demo-design-9-00</span><br><span class="line">└── src</span><br><span class="line">    └── main</span><br><span class="line">        └── java</span><br><span class="line">            └── org.itstack.demo.design</span><br><span class="line">                ├── HandlerInterceptor.java</span><br><span class="line">                └── SsoInterceptor.java</span><br></pre></td></tr></table></figure>

<ul>
<li>这里模拟的是spring中的类：<code>HandlerInterceptor</code>，实现接口功能<code>SsoInterceptor</code>模拟的单点登录拦截服务。</li>
<li>为了避免引入太多spring的内容影响对设计模式的阅读，这里使用了同名的类和方法，尽可能减少外部的依赖</li>
</ul>
<p>模拟<code>spring</code>的<code>HanlderInterceptor</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">HandleInterceptor</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(String request,String response,Object handler)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实际的单点登录开发会基于<code>org.springframework.web.servlet.HandlerInterceptor</code>  来实现</p>
<p>模拟单点登录操作功能</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SsoInterceptor</span> <span class="keyword">implements</span>  <span class="title">HandleInterceptor</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandel</span><span class="params">(String request,String response,Object handler)</span></span>&#123;</span><br><span class="line">        <span class="comment">//模拟获取cookie</span></span><br><span class="line">        String ticket = request.substring(<span class="number">1</span>,<span class="number">8</span>);</span><br><span class="line">        <span class="comment">//模拟校验</span></span><br><span class="line">        <span class="keyword">return</span> ticket.equals(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>这里的模拟实现非常的简单只是截取字符串。实际使用需要从<code>HttpServletRequest request</code>对象中获取<code>cookie</code>信息，解析<code>ticket</code>值做校验。</li>
<li>在返回的里面而非常的简单，只要获取到了success就认为允许登录</li>
</ul>
<h2 id="三、装饰器模式重构代码"><a href="#三、装饰器模式重构代码" class="headerlink" title="三、装饰器模式重构代码"></a>三、装饰器模式重构代码</h2><p>装饰器模式主要解决的是直接继承下因功能的不断横向扩展导致子类膨胀的问题,而是用装饰器模式后就会比直接继承显得更加灵活,同事这样也就不再需要子类的维护</p>
<p>在装饰器模式中有四个比较重要的角色:</p>
<ol>
<li>抽象构建角色 – 定义抽象接口</li>
<li>具体构建角色 – 实现抽象接口,可以是一组</li>
<li>装饰角色 – 定义抽象类并继承接口中的方法,保证一致性</li>
<li>具体装饰角色 – 扩展装饰具体的实现逻辑</li>
</ol>
<p>通过以上这四项来实现装饰器模式,主要核心内容会体现在抽象类的定义和实现上.</p>
<p>工程结构</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">├─src</span><br><span class="line">│  ├─main</span><br><span class="line">│  │  └─java</span><br><span class="line">│  │      └─org</span><br><span class="line">│  │          └─itstack</span><br><span class="line">│  │              └─demo</span><br><span class="line">│  │                  └─design</span><br><span class="line">│  │                          HandlerInterceptor.java</span><br><span class="line">│  │                          SsoInterceptor.java</span><br></pre></td></tr></table></figure>

<p><img src="https://bugstack.cn/assets/images/2020/itstack-demo-design-9-03.png" alt="装饰器模式模型结构"></p>
<ul>
<li>以上是一个装饰器实现的类图结构,重点的类是<code>SsoDecorator</code> ,这个类是一个抽象类,主要完成了对接口<code>handlerIntercrptor</code>  继承</li>
<li>当装饰角色继承接口后会提供构造函数,入参就是继承的接口实现类即可,这样就可以很方便的扩展出不同功能的组件</li>
</ul>
<p><strong>代码实现</strong></p>
<p>抽象类装饰角色</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">SsoDecorator</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> HandleInterceptor handleInterceptor;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SsoDecorator</span> <span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SsoDecorator</span><span class="params">(HandleInterceptor handleInterceptor)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.handleInterceptor = handleInterceptor;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(String request,String response,Object handler)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> handleInterceptor.preHandle(requrst,response,handler);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>在 装饰类中有两个重点的地方是: 1&gt;继承了处理接口 2&gt;提供了构造函数 3&gt;覆盖了方法 <code>preHandle</code></li>
<li>以上三个点是装饰器模式的核心处理部分,这样可以踢掉对子类继承的方式时间逻辑功能扩展</li>
</ul>
<p>装饰角色逻辑实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginSsoDecorator</span> <span class="keyword">extends</span> <span class="title">SsoDecorator</span></span>&#123;</span><br><span class="line">     <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(LoginSsoDecorator.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, String&gt; authMap = <span class="keyword">new</span> ConcurrentHashMap&lt;String, String&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        authMap.put(<span class="string">&quot;huahua&quot;</span>, <span class="string">&quot;queryUserInfo&quot;</span>);</span><br><span class="line">        authMap.put(<span class="string">&quot;doudou&quot;</span>, <span class="string">&quot;queryUserInfo&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LoginSsoDecorator</span><span class="params">(HandlerInterceptor handlerInterceptor)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(handlerInterceptor);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(String request, String response, Object handler)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> success = <span class="keyword">super</span>.preHandle(request, response, handler);</span><br><span class="line">        <span class="keyword">if</span> (!success) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        String userId = request.substring(<span class="number">8</span>);</span><br><span class="line">        String method = authMap.get(userId);</span><br><span class="line">        logger.info(<span class="string">&quot;模拟单点登录方法访问拦截校验：&#123;&#125; &#123;&#125;&quot;</span>, userId, method);</span><br><span class="line">        <span class="comment">// 模拟方法校验</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;queryUserInfo&quot;</span>.equals(method);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>在具体的装饰类实现中,继承了装饰类<code>SsoDecorator</code> 那么现在就可以扩展方法,<code>preHandle</code></li>
<li>在<code>preHandel</code>的实现中可以看到,这里只关心扩展的部分功能,同时不会影响原有类的核心服务,也不会因为使用继承方式而导致的多余子类,增加了整体的灵活性</li>
</ul>
<h2 id="四、总结"><a href="#四、总结" class="headerlink" title="四、总结"></a>四、总结</h2><ul>
<li>使用装饰器模式满足单元职责原则,你可以在自己的装饰类中完成功能逻辑的扩展,而不影响主类,同时可以按需在运行时添加和删除这部分逻辑,另外装饰器模式与继承弗雷重写方法,在某些时候需要按需选择,并不一定某一个就是最好</li>
<li>装饰器实现的重点是对抽象类继承接口方式的使用,同时设定被集成的接口可以通过构造函数传递其实现类,由此增加扩展性并重写方法里可以实现此部分父类实现的功能</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/11/%E9%98%BF%E9%87%8Cdruid%E6%95%B0%E6%8D%AE%E6%BA%90%E9%85%8D%E7%BD%AE%E5%8F%8A%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AF%86%E7%A0%81%E5%8A%A0%E5%AF%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="冯玮">
      <meta itemprop="description" content="以梦为马，明日天涯">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="冯玮的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/11/%E9%98%BF%E9%87%8Cdruid%E6%95%B0%E6%8D%AE%E6%BA%90%E9%85%8D%E7%BD%AE%E5%8F%8A%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AF%86%E7%A0%81%E5%8A%A0%E5%AF%86/" class="post-title-link" itemprop="url">阿里druid数据源配置及数据库密码加密</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-11-11 22:30:04 / 修改时间：22:30:32" itemprop="dateCreated datePublished" datetime="2020-11-11T22:30:04+08:00">2020-11-11</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="阿里druid数据源配置及数据库密码加密"><a href="#阿里druid数据源配置及数据库密码加密" class="headerlink" title="阿里druid数据源配置及数据库密码加密"></a>阿里druid数据源配置及数据库密码加密</h1><p>注意:</p>
<ul>
<li>阿里默认只对用户密码解密</li>
<li>druid 1.0.16版本及以上的解密时同时配置publicKey</li>
</ul>
<h2 id="生成密文密码"><a href="#生成密文密码" class="headerlink" title="生成密文密码"></a>生成密文密码</h2><ol>
<li><p>前提是已经配置了JDK环境,生成密文密码需要准备druid的jar包,然后通过命令行生成.如下步骤:</p>
<p>准备jar包,执行命令行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp druid-1.1.21.jar com.alibaba.druid.filter.config.ConfigTools yourpassword</span><br></pre></td></tr></table></figure>

<p>注意:druid1.0.16之前</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java <span class="literal">-cp</span> druid<span class="literal">-0</span>.<span class="number">2.23</span>.jar com.alibaba.druid.filter.config.ConfigTools yourpassword  </span><br></pre></td></tr></table></figure>



</li>
</ol>
<p><img src="https://img2018.cnblogs.com/blog/1179838/201907/1179838-20190710105734396-200140930.png" alt="img"></p>
<p>注意在druid 1.0.16及以后</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp druid-1.1.9.jar com.alibaba.druid.filter.config.ConfigTools 123456pwd &gt;aaa.txt </span><br></pre></td></tr></table></figure>

<p><img src="https://img2018.cnblogs.com/blog/1179838/201907/1179838-20190710105757521-1711488764.png" alt="img"></p>
<h2 id="dataSource配置"><a href="#dataSource配置" class="headerlink" title="dataSource配置"></a>dataSource配置</h2><p>jdbc.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## JDBC set</span></span><br><span class="line"><span class="meta">jdbc.url</span>=<span class="string">jdbc\:mysql\://localhost\:3306/edu_demo?useUnicode\=true&amp;characterEncoding\=utf-8</span></span><br><span class="line"><span class="meta">jdbc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">jdbc.password</span>=<span class="string">Obsbr4gd1oVyYr+k4KQdUMNYgKMWdDibsNJTabnph+yPmxjc6tUrT1GNsPDqa9ZvTF9QvaRD86H+Zn/H+yz2jA\=\=</span></span><br></pre></td></tr></table></figure>

<p>dataSource配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 基于Druid数据库链接池的数据源配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span> <span class="attr">init-method</span>=<span class="string">&quot;init&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;close&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 基本属性driverClassName、 url、user、password --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置初始化大小、最小、最大 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 通常来说，只需要修改initialSize、minIdle、maxActive --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;initialSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;minIdle&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxActive&quot;</span> <span class="attr">value</span>=<span class="string">&quot;30&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;testWhileIdle&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置获取连接等待超时的时间 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxWait&quot;</span> <span class="attr">value</span>=<span class="string">&quot;5000&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置一个连接在池中最小生存的时间，单位是毫秒 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;minEvictableIdleTimeMillis&quot;</span> <span class="attr">value</span>=<span class="string">&quot;30000&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置间隔多久才进行一次检测，检测需要关闭的空闲连接，单位是毫秒 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;timeBetweenEvictionRunsMillis&quot;</span> <span class="attr">value</span>=<span class="string">&quot;60000&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 解密密码必须要配置的项 *************************************  这里是重点--&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;filters&quot;</span> <span class="attr">value</span>=<span class="string">&quot;config&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;connectionProperties&quot;</span> <span class="attr">value</span>=<span class="string">&quot;config.decrypt=true&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意: druid及以后</p>
<p>jdbc.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## JDBC set</span></span><br><span class="line"><span class="meta">jdbc.url</span>=<span class="string">jdbc\:mysql\://localhost\:3306/edu_demo?useUnicode\=true&amp;characterEncoding\=utf-8</span></span><br><span class="line"><span class="meta">jdbc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">jdbc.password</span>=<span class="string">Obsbr4gd1oVyYr+k4KQdUMNYgKMWdDibsNJTabnph+yPmxjc6tUrT1GNsPDqa9ZvTF9QvaRD86H+Zn/H+yz2jA\=\=</span></span><br><span class="line"><span class="meta">jdbc.publickey</span> = <span class="string">MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAKHGwq7q2RmwuRgKxBypQHw0mYu4BQZ3eMsTrdK8E6igRcxsobUC7uT0SoxIjl1WveWniCASejoQtn/BY6hVKWsCAwEAAQ==</span></span><br></pre></td></tr></table></figure>

<p>dataSource配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 基于Druid数据库链接池的数据源配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span> <span class="attr">init-method</span>=<span class="string">&quot;init&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;close&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 基本属性driverClassName、 url、user、password --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 解密密码必须要配置的项 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;filters&quot;</span> <span class="attr">value</span>=<span class="string">&quot;config&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;connectionProperties&quot;</span> <span class="attr">value</span>=<span class="string">&quot;config.decrypt=true;config.decrypt.key=$&#123;jdbc.publickey&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置初始化大小、最小、最大 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 通常来说，只需要修改initialSize、minIdle、maxActive --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;initialSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;minIdle&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxActive&quot;</span> <span class="attr">value</span>=<span class="string">&quot;30&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;testWhileIdle&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置获取连接等待超时的时间 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxWait&quot;</span> <span class="attr">value</span>=<span class="string">&quot;5000&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置一个连接在池中最小生存的时间，单位是毫秒 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;minEvictableIdleTimeMillis&quot;</span> <span class="attr">value</span>=<span class="string">&quot;30000&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置间隔多久才进行一次检测，检测需要关闭的空闲连接，单位是毫秒 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;timeBetweenEvictionRunsMillis&quot;</span> <span class="attr">value</span>=<span class="string">&quot;60000&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>以上就是druid提供的明文加密的配置方案.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/06/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="冯玮">
      <meta itemprop="description" content="以梦为马，明日天涯">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="冯玮的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/06/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/" class="post-title-link" itemprop="url">设计模式-适配器模式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-11-06 08:44:32 / 修改时间：08:45:04" itemprop="dateCreated datePublished" datetime="2020-11-06T08:44:32+08:00">2020-11-06</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="适配器模式"><a href="#适配器模式" class="headerlink" title="适配器模式"></a>适配器模式</h1><h2 id="案例场景"><a href="#案例场景" class="headerlink" title="案例场景"></a>案例场景</h2><p> 随着公司业务的不断发展,当基础的系统逐步成型以后,业务运营就需要开始做用户的拉新和促活.从而保障<code>DUA</code>的增速以及最终<code>ROI</code>转换</p>
<p>而这时候就会需要做一些营销系统,大部分常见的都是裂变.拉客,例如:你邀请一个用户开户,或者邀请一个用户下单,那么平台就会给你返利,多邀多得,同事随着拉新的 量越来越多开始设置每月下单都会给首单奖励等等买各种营销场景</p>
<p>那么这个时候会做一个系统就会接收各种各样的MQ消息或者接口,如果一个个的去开发,就会耗费很大的成本,同事对于后期的拓展也有一定的难度,此时就会希望有一个系统可以配置一下就把外部的MQ接入进行,这些MQ就像上面提到的可能是 一些注册开户信息,商品下单消息等等</p>
<p>而适配器的思想方式也恰恰可以御用到这里,并且我想强调 一下,适配器不只是可以适配接口往往还可以适配一些属性信息.</p>
<p>1.场景模拟工程</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">itstack-demo-design-6-00</span><br><span class="line">└── src</span><br><span class="line">    └── main</span><br><span class="line">        └── java</span><br><span class="line">            └── org.itstack.demo.design</span><br><span class="line">                ├── mq</span><br><span class="line">                │   ├── create_account.java</span><br><span class="line">                │   ├── OrderMq.java</span><br><span class="line">                │   └── POPOrderDelivered.java</span><br><span class="line">                └── service</span><br><span class="line">                    ├── OrderServicejava</span><br><span class="line">                    └── POPOrderService.java</span><br></pre></td></tr></table></figure>

<ul>
<li>这里模拟了三个不同类型的MQ消息,而在消息体中都有一些必要的字段,比如用户ID,时间,业务id.但每个MQ消息的字段属性并不一样.就像用户id在不同的MQ里也有不同的字段:uid,userid等</li>
<li>同时还提供了两个不同类型的接口,一个用于查询内部订单下单数量,一个 用于第三方是否首单</li>
<li>后面会把这些不同类型的MQ和接口做适配兼容</li>
</ul>
<p>2.场景简述</p>
<p>注册开户MQ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">create_account</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String number;      <span class="comment">// 开户编号</span></span><br><span class="line">    <span class="keyword">private</span> String address;     <span class="comment">// 开户地</span></span><br><span class="line">    <span class="keyword">private</span> Date accountDate;   <span class="comment">// 开户时间</span></span><br><span class="line">    <span class="keyword">private</span> String desc;        <span class="comment">// 开户描述</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... get/set     </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>内部订单MQ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderMq</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String uid;           <span class="comment">// 用户ID</span></span><br><span class="line">    <span class="keyword">private</span> String sku;           <span class="comment">// 商品</span></span><br><span class="line">    <span class="keyword">private</span> String orderId;       <span class="comment">// 订单ID</span></span><br><span class="line">    <span class="keyword">private</span> Date createOrderTime; <span class="comment">// 下单时间     </span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... get/set      </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第三方订单MQ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">POPOrderDelivered</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String uId;     <span class="comment">// 用户ID</span></span><br><span class="line">    <span class="keyword">private</span> String orderId; <span class="comment">// 订单号</span></span><br><span class="line">    <span class="keyword">private</span> Date orderTime; <span class="comment">// 下单时间</span></span><br><span class="line">    <span class="keyword">private</span> Date sku;       <span class="comment">// 商品</span></span><br><span class="line">    <span class="keyword">private</span> Date skuName;   <span class="comment">// 商品名称</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal decimal; <span class="comment">// 金额</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... get/set      </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>查询用户内部下单数量接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(POPOrderService.class);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">queryUserOrderCount</span><span class="params">(String userId)</span></span>&#123;</span><br><span class="line">        logger.info(<span class="string">&quot;自营商家，查询用户的订单是否为首单：&#123;&#125;&quot;</span>, userId);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">10L</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>查询用户第三方下单首单接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">POPOrderService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(POPOrderService.class);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isFirstOrder</span><span class="params">(String uId)</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">&quot;POP商家，查询用户的订单是否为首单：&#123;&#125;&quot;</span>, uId);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>以上这几项就是不同MQ以及不同的 接口的一个体现,后面我们将使用这样的MQ消息和接口给他们做相应的适配</li>
</ul>
<h2 id="适配器模式构造代码"><a href="#适配器模式构造代码" class="headerlink" title="适配器模式构造代码"></a>适配器模式构造代码</h2><p> 统一的MQ消息体适配器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RebateInfo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String userId;  <span class="comment">// 用户ID</span></span><br><span class="line">    <span class="keyword">private</span> String bizId;   <span class="comment">// 业务ID</span></span><br><span class="line">    <span class="keyword">private</span> Date bizTime;   <span class="comment">// 业务时间</span></span><br><span class="line">    <span class="keyword">private</span> String desc;    <span class="comment">// 业务描述</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ... get/set</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>MQ消息中会有多种多样的类型属性,虽然他们都有同样的值提供给适用方,但是如果都这样接入那么当MQ消息特别多的时候就会很麻烦</li>
<li>所以在这个 案例中,我们定义了通用的MQ消息体,后续把所有接入进来的消息进行统一的处理</li>
</ul>
<p>MQ消息体适配器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MQAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> RebateInfo <span class="title">filter</span><span class="params">(String strJson, Map&lt;String, String&gt; link)</span> <span class="keyword">throws</span> NoSuchMethodException, InvocationTargetException, IllegalAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> filter(JSON.parseObject(strJson, Map.class), link);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> RebateInfo <span class="title">filter</span><span class="params">(Map obj, Map&lt;String, String&gt; link)</span> <span class="keyword">throws</span> NoSuchMethodException, InvocationTargetException, IllegalAccessException </span>&#123;</span><br><span class="line">        RebateInfo rebateInfo = <span class="keyword">new</span> RebateInfo();</span><br><span class="line">        <span class="keyword">for</span> (String key : link.keySet()) &#123;</span><br><span class="line">            Object val = obj.get(link.get(key));</span><br><span class="line">            RebateInfo.class.getMethod(<span class="string">&quot;set&quot;</span> + key.substring(<span class="number">0</span>, <span class="number">1</span>).toUpperCase() + key.substring(<span class="number">1</span>), String.class).invoke(rebateInfo, val.toString());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> rebateInfo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>这个类中的方法非常的重要,主要 用于把不同类型的MQ的各种属性映射成我们需要的属性并返回,.就像用户id.uid ,映射成我们需要的userid 做统一处理</p>
</li>
<li><p>而在这个处理过程中需要把映射管理传递给<code>Map&lt;String,String&gt; link</code>,就是准确的描述了,当前MQ中某个属性的名称,映射为我们的某个属性名称</p>
</li>
<li><p>最终因为我们接受到的mq消息基本都是json格式,可以转换为map格式,最后使用反射调用的方式给我们的类型赋值</p>
<p>测试适配类</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_MQAdapter</span><span class="params">()</span> <span class="keyword">throws</span> NoSuchMethodException, IllegalAccessException, InvocationTargetException </span>&#123;</span><br><span class="line">    create_account create_account = <span class="keyword">new</span> create_account();</span><br><span class="line">    create_account.setNumber(<span class="string">&quot;100001&quot;</span>);</span><br><span class="line">    create_account.setAddress(<span class="string">&quot;河北省.廊坊市.广阳区.大学里职业技术学院&quot;</span>);</span><br><span class="line">    create_account.setAccountDate(<span class="keyword">new</span> Date());</span><br><span class="line">    create_account.setDesc(<span class="string">&quot;在校开户&quot;</span>);          </span><br><span class="line"></span><br><span class="line">    HashMap&lt;String, String&gt; link01 = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">    link01.put(<span class="string">&quot;userId&quot;</span>, <span class="string">&quot;number&quot;</span>);</span><br><span class="line">    link01.put(<span class="string">&quot;bizId&quot;</span>, <span class="string">&quot;number&quot;</span>);</span><br><span class="line">    link01.put(<span class="string">&quot;bizTime&quot;</span>, <span class="string">&quot;accountDate&quot;</span>);</span><br><span class="line">    link01.put(<span class="string">&quot;desc&quot;</span>, <span class="string">&quot;desc&quot;</span>);</span><br><span class="line">    RebateInfo rebateInfo01 = MQAdapter.filter(create_account.toString(), link01);</span><br><span class="line">    System.out.println(<span class="string">&quot;mq.create_account(适配前)&quot;</span> + create_account.toString());</span><br><span class="line">    System.out.println(<span class="string">&quot;mq.create_account(适配后)&quot;</span> + JSON.toJSONString(rebateInfo01));</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    OrderMq orderMq = <span class="keyword">new</span> OrderMq();</span><br><span class="line">    orderMq.setUid(<span class="string">&quot;100001&quot;</span>);</span><br><span class="line">    orderMq.setSku(<span class="string">&quot;10928092093111123&quot;</span>);</span><br><span class="line">    orderMq.setOrderId(<span class="string">&quot;100000890193847111&quot;</span>);</span><br><span class="line">    orderMq.setCreateOrderTime(<span class="keyword">new</span> Date()); </span><br><span class="line"></span><br><span class="line">    HashMap&lt;String, String&gt; link02 = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">    link02.put(<span class="string">&quot;userId&quot;</span>, <span class="string">&quot;uid&quot;</span>);</span><br><span class="line">    link02.put(<span class="string">&quot;bizId&quot;</span>, <span class="string">&quot;orderId&quot;</span>);</span><br><span class="line">    link02.put(<span class="string">&quot;bizTime&quot;</span>, <span class="string">&quot;createOrderTime&quot;</span>);</span><br><span class="line">    RebateInfo rebateInfo02 = MQAdapter.filter(orderMq.toString(), link02);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;mq.orderMq(适配前)&quot;</span> + orderMq.toString());</span><br><span class="line">    System.out.println(<span class="string">&quot;mq.orderMq(适配后)&quot;</span> + JSON.toJSONString(rebateInfo02));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>在这里我们分别模拟传入了两个不同的MQ消息，并设置字段的映射关系。</li>
<li>等真的业务场景开发中，就可以配这种映射配置关系交给配置文件或者数据库后台配置，减少编码。</li>
</ul>
<p>测试结果</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mq.create_account(适配前)&#123;<span class="string">&quot;accountDate&quot;</span>:<span class="number">1591024816000</span>,<span class="string">&quot;address&quot;</span>:<span class="string">&quot;河北省.廊坊市.广阳区.大学里职业技术学院&quot;</span>,<span class="string">&quot;desc&quot;</span>:<span class="string">&quot;在校开户&quot;</span>,<span class="string">&quot;number&quot;</span>:<span class="string">&quot;100001&quot;</span>&#125;</span><br><span class="line">mq.create_account(适配后)&#123;<span class="string">&quot;bizId&quot;</span>:<span class="string">&quot;100001&quot;</span>,<span class="string">&quot;bizTime&quot;</span>:<span class="number">1591077840669</span>,<span class="string">&quot;desc&quot;</span>:<span class="string">&quot;在校开户&quot;</span>,<span class="string">&quot;userId&quot;</span>:<span class="string">&quot;100001&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">mq.orderMq(适配前)&#123;<span class="string">&quot;createOrderTime&quot;</span>:<span class="number">1591024816000</span>,<span class="string">&quot;orderId&quot;</span>:<span class="string">&quot;100000890193847111&quot;</span>,<span class="string">&quot;sku&quot;</span>:<span class="string">&quot;10928092093111123&quot;</span>,<span class="string">&quot;uid&quot;</span>:<span class="string">&quot;100001&quot;</span>&#125;</span><br><span class="line">mq.orderMq(适配后)&#123;<span class="string">&quot;bizId&quot;</span>:<span class="string">&quot;100000890193847111&quot;</span>,<span class="string">&quot;bizTime&quot;</span>:<span class="number">1591077840669</span>,<span class="string">&quot;userId&quot;</span>:<span class="string">&quot;100001&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br></pre></td></tr></table></figure>

<ul>
<li>从上面可以看到，同样的字段值在做了适配前后分别有统一的字段属性，进行处理。这样业务开发中也就非常简单了。</li>
<li>另外有一个非常重要的地方，在实际业务开发中，除了反射的使用外，还可以加入<strong>代理类</strong>把映射的配置交给它。这样就可以不需要每一个mq都手动创建类了。</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/04/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="冯玮">
      <meta itemprop="description" content="以梦为马，明日天涯">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="冯玮的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/04/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/" class="post-title-link" itemprop="url">设计模式-单例模式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-11-04 17:24:32 / 修改时间：17:24:50" itemprop="dateCreated datePublished" datetime="2020-11-04T17:24:32+08:00">2020-11-04</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>设计模式—-单例模式</strong></p>
<p><strong>单例模式介绍</strong></p>
<p>单例模式是整个设计模式中最简单的模式之一,而且这种方式即使在没有看设计模式相关资料也会常用在编码开发中.</p>
<p>因为在编程开发中经常会遇到这样一种场景,那就是需要保证一个类只有一个实例哪怕是多线程同时访问,并需要提供一个全局访问此实例的点</p>
<p>综合以上.我们平常的开发中,可以总结一条经验,单例模式主要解决的是,一个全局使用的类频繁的创建和消费,从而提升整体的代码的性能</p>
<p><strong>案例场景</strong></p>
<p>例如</p>
<ol>
<li>数据库的连接池不会反复创建</li>
<li>spring中的一个单例模式bean的生成和使用</li>
<li>在我们平常的代码中需要设置全局的一些属性保存</li>
</ol>
<p><strong>7种单例模式实现</strong></p>
<p>单例模式的实现方式比较多,主要实现上是是否支持懒汉模式,是否线程安全中运用各种技巧,当然也有 一些场景不需要考虑懒加载也就是懒汉模式的情况下,会直接使用<code>static</code>静态类或属性和方法的方式进行处理,供外部调用</p>
<p>以下就是7种单例模式的实现方式</p>
<p><strong>0.静态类使用</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton_00</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;Stirng,String&gt; cache = <span class="keyword">new</span> ConcurrentHashMap&lt;String,String&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>以上这种方式在我们平常的业务开发中非常场常见，这样静态类的方式可以在第一次运行的时候直接初始化Map类，同时这里我们也不需要到延迟加载在使用。</li>
<li>在不需要维持任何状态下，仅仅用于全局访问，这个使用使用静态类的方式更加方便。</li>
<li>但如果需要被继承以及需要维持一些特定状态的情况下，就适合使用单例模式。</li>
</ul>
<p><strong>1.懒汉模式(线程不安全)</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton_01</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Static Singleton_01 instance;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton_01</span><span class="params">()</span></span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton_01 <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span> !=  instance)&#123;</span><br><span class="line">            <span class="keyword">return</span> instance</span><br><span class="line">        &#125;</span><br><span class="line">        instance = <span class="keyword">new</span> Singleton_01();</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>单例模式有一个特点就是不允许外部直接创建,也就是私有的构造函数</li>
<li>目前此方式的单例确实满足了懒加载,但是如果有多个访问者同事去获取对象实例,你那么就会早场多个同样的实例并存,从而没有达到单例的 要求</li>
</ul>
<p><strong>2.懒汉模式(线程安全)</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">singleton_02</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> singleton_02 instance;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton_02</span><span class="params">()</span></span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> synchrinized Singleton_02 <span class="title">getIntance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span> != instance)&#123;</span><br><span class="line">            <span class="keyword">return</span> instance</span><br><span class="line">        &#125;</span><br><span class="line">        instance = <span class="keyword">new</span> Singleton_02();</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>此种模式虽然是安全的,但是由于把锁加到方法上后,所有的访问都因为需要锁占用导致资源的浪费,如果不是特殊情况下,不建议此种方式时间单例模式</li>
</ul>
<p><strong>3.饿汉模式(线程安全)</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton_03</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton_03 = <span class="keyword">new</span> Singleton_03():</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton_03</span><span class="params">()</span></span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton_03 <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>此种方式与我们开头的第一个实例化<code>Map</code>基本一致，在程序启动的时候直接运行加载，后续有外部需要使用的时候获取即可。</li>
<li>但此种方式并不是<code>懒加载</code>，也就是说无论你程序中是否用到这样的类都会在<strong>程序启动之初</strong>进行创建。</li>
<li>那么这种方式导致的问题就像你下载个游戏软件，可能你游戏地图还没有打开呢，但是程序已经将这些地图全部实例化。到你手机上最明显体验就一开游戏内存满了，手机卡了，需要换了。</li>
</ul>
<p><strong>4.使用类的内部类(线程安全)</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sinleton_04</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton_04</span><span class="params">()</span></span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton_04 <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonHolder.instance;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonHolder</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> Singleton_04 instance = <span class="keyword">new</span> Single_04();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>使用类的静态内部类实现的单例模式，既保证了线程安全有保证了懒加载，同时不会因为加锁的方式耗费性能。</p>
</li>
<li><p>这主要是因为JVM虚拟机可以保证多线程并发访问的正确性，也就是一个类的构造方法在多线程环境下可以被正确的加载。</p>
</li>
<li><p>此种方式也是非常推荐使用的一种单例模式</p>
</li>
</ul>
<p><strong>5.双重锁校验（线程安全）</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton_05</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton_05 instance;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton_05</span><span class="params">()</span></span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton_05 <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span> != instance)&#123;</span><br><span class="line">            <span class="keyword">return</span> instance;</span><br><span class="line">        &#125;</span><br><span class="line">        ysnchoinized(Singleton_05.class)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">null</span> == intance)&#123;</span><br><span class="line">                 instance = <span class="keyword">new</span> Singleton_05();</span><br><span class="line">            &#125;</span><br><span class="line">           <span class="keyword">return</span> instance;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>双重锁的方式是方法级锁的优化，减少了部分获取实例的耗时。</li>
<li>同时这种方式也满足了懒加载。</li>
</ul>
<p><strong>6.CAS「AtomicReference」(线程安全)</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton_06</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton_06</span><span class="params">()</span></span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton_06 instance;</span><br><span class="line">    <span class="keyword">private</span> staic <span class="keyword">final</span> AtomicReference&lt;Singleton_06&gt; INSTANCE = <span class="keyword">new</span> AtomicReference&lt;&gt;();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton_06 <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(;;)&#123;</span><br><span class="line">            instance = INSTANCE.get();</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">null</span> != instance)&#123;</span><br><span class="line">                <span class="keyword">return</span> instance;</span><br><span class="line">            &#125;</span><br><span class="line">            INSTANCE.compatorAndSet(<span class="keyword">null</span>,<span class="keyword">new</span> Singleton_06());</span><br><span class="line">            <span class="keyword">return</span> INSTANCE.get();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>java并发库提供了很多原子类来支持并发访问的数据安全性；<code>AtomicInteger</code>、<code>AtomicBoolean</code>、<code>AtomicLong</code>、<code>AtomicReference</code>。</li>
<li>AtomicReference 可以封装引用一个V实例，支持并发访问如上的单例方式就是使用了这样的一个特点。</li>
<li>使用CAS的好处就是不需要使用传统的加锁方式保证线程安全，而是依赖于CAS的忙等算法，依赖于底层硬件的实现，来保证线程安全。相对于其他锁的实现没有线程的切换和阻塞也就没有了额外的开销，并且可以支持较大的并发性。</li>
<li>当然CAS也有一个缺点就是忙等，如果一直没有获取到将会处于死循环中。</li>
</ul>
<p><strong>7.枚举法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">Singleton_07</span></span>&#123;</span><br><span class="line">    INSTANCE;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dosomthing</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;hello~~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<blockquote>
<p>约书亚·布洛克（英语：Joshua J. Bloch，1961年8月28日－），美国著名程序员。他为Java平台设计并实作了许多的功能，曾担任Google的首席Java架构师（Chief Java Architect）。</p>
</blockquote>
<p><strong>调用方式</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Singleton_07.INSTANCE.dosomthing();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>这种写法在功能上与共有域方法相近，但是它更简洁，无偿地提供了串行化机制，绝对防止对此实例化，即使是在面对复杂的串行化或者反射攻击的时候。虽然这中方法还没有广泛采用，但是单元素的枚举类型已经成为实现Singleton的最佳方法。</em></p>
<p>但也要知道此种方式在存在继承场景下是不可用的。</p>
<p><strong>总结</strong></p>
<ul>
<li>单例模式,很常用,常见的一种设计模式,也是比较简单的设计模式,但是单例模式包含很多的方法,懒汉,饿汉线程是否安全,静态类,内部类,加锁,串行化枚举等等</li>
<li>在平时的开发中,如果确保此类是全局可用不需要做懒加载,那么直接创建给并给外部调用即可,但是在很多的时候,有些是需要触发一定的条件后才有效, 那么一定要用懒加载,线程的安全上可以按需选择</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/04/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="冯玮">
      <meta itemprop="description" content="以梦为马，明日天涯">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="冯玮的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/04/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F/" class="post-title-link" itemprop="url">设计模式-原型模式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-11-04 14:28:46 / 修改时间：14:29:11" itemprop="dateCreated datePublished" datetime="2020-11-04T14:28:46+08:00">2020-11-04</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="设计模式——-原型模式"><a href="#设计模式——-原型模式" class="headerlink" title="设计模式—— 原型模式"></a>设计模式—— 原型模式</h1><p><strong>原型模式介绍</strong></p>
<p>原型模式主要解决的问题就是创建重复对象，而这部分<code>对象</code>内容本身比较复杂，生成过程可能从库或者RPC接口中获取数据的耗时较长，因此采用克隆的方式节省时间。</p>
<p>其实这种场景经常出现在我们的身边，只不过很少用到自己的开发中，就像； </p>
<ol>
<li>你经常<code>Ctrl+C</code>、<code>Ctrl+V</code>，复制粘贴代码。</li>
<li>Java多数类中提供的API方法；<code>Object clone()</code>。</li>
<li>细胞的有丝分裂。</li>
</ol>
<p>类似以上的场景并不少，但如果让你去思考平时的代码开发中，有用到这样的设计模式吗？确实不那么容易找到，甚至有时候是忽略了这个设计模式的方式。在没有阅读下文之前，也可以思考下哪些场景可以用到。</p>
<p>每个人都经历过考试，从纸制版到上机答题，大大小小也有几百场。而以前坐在教室里答题身边的人都是一套试卷，考试的时候还能偷摸或者别人给发信息抄一抄答案。</p>
<p>但从一部分可以上机考试的内容开始，在保证大家的公平性一样的题目下，开始出现试题混排更有做的好的答案选项也混排。这样大大的增加了抄的成本，也更好的做到了考试的公平性。</p>
<p><strong>但如果这个公平性的考试需求交给你来完成，你会怎么做？</strong></p>
<p>因为需要实现一个上机考试抽题的服务，因此在这里建造一个题库题目的场景类信息，用于创建；<code>选择题</code>、<code>问答题</code>。</p>
<p>创建<code>选择题</code>,<code>问答题</code>两个实体类 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AnswerQuestion</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String key;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AnswerQuestion</span><span class="params">(String name, String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.key = key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setKey</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.key = key;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChoiceQuestion</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name; <span class="comment">//题目</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, String&gt; option; <span class="comment">//选项</span></span><br><span class="line">    <span class="keyword">private</span> String key; <span class="comment">//答案</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ChoiceQuestion</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ChoiceQuestion</span><span class="params">(String name, Map&lt;String, String&gt; option, String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.option = option;</span><br><span class="line">        <span class="keyword">this</span>.key = key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, String&gt; <span class="title">getOption</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> option;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOption</span><span class="params">(Map&lt;String, String&gt; option)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.option = option;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setKey</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.key = key;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>这里简单的创建了两种提醒简答题和选择题,有需要的可以继续添加其他类型的题目</li>
</ul>
<p><strong>原型结构</strong></p>
<p><img src="https://bugstack.cn/assets/images/2020/itstack-demo-design-4-03.png" alt="原型模式模型结构"></p>
<ul>
<li>工程中包括了核心的题库类<code>QuestionBank</code>，题库中主要负责将各个的题目进行组装最终输出试卷。</li>
<li>针对每一个试卷都会使用克隆的方式进行复制，复制完成后将试卷中题目以及每个题目的答案进行乱序处理。这里提供了工具包；<em>TopicRandomUtil</em></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Topic</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String newKey;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, String&gt; newOption;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Topic</span><span class="params">(String newKey, Map&lt;String, String&gt; newOption)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.newKey = newKey;</span><br><span class="line">        <span class="keyword">this</span>.newOption = newOption;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getNewKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> newKey;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNewKey</span><span class="params">(String newKey)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.newKey = newKey;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, String&gt; <span class="title">getNewOption</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> newOption;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNewOption</span><span class="params">(Map&lt;String, String&gt; newOption)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.newOption = newOption;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        stringBuilder.append(<span class="string">&quot;答案：&quot;</span>+<span class="keyword">this</span>.newKey+<span class="string">&quot;\t\n&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String s : newOption.keySet()) &#123;</span><br><span class="line">            stringBuilder.append(s).append(<span class="string">&quot;. &quot;</span>).append(newOption.get(s)+<span class="string">&quot;\t\n\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> stringBuilder.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 交换ABCD之间的答案</span></span><br><span class="line"><span class="comment"> * 打乱选项,并把正确答案找出来</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TopicRandomUtil</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Topic <span class="title">random</span><span class="params">(Map&lt;String,String&gt; option,String key)</span></span>&#123;</span><br><span class="line">        Set&lt;String&gt; keySet = option.keySet(); <span class="comment">//获取ABCD顺序</span></span><br><span class="line">        List&lt;String&gt; keyList = <span class="keyword">new</span> ArrayList&lt;&gt;(keySet);</span><br><span class="line">        Collections.shuffle(keyList); <span class="comment">//打乱ABCD</span></span><br><span class="line">        Map&lt;String, String&gt; newOption = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">int</span> index = <span class="number">0</span>;<span class="comment">//获取打乱的ABCD次序</span></span><br><span class="line">        String newKey = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (String next : keySet) &#123;</span><br><span class="line">            String randomKey = keyList.get(index++);</span><br><span class="line">            newOption.put(randomKey, option.get(next));<span class="comment">//根据打乱的次序依次获取选项内容</span></span><br><span class="line">            <span class="keyword">if</span>(next.equals(key))&#123;<span class="comment">//选中答案</span></span><br><span class="line">                newKey = randomKey;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Topic(newKey, newOption);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>可能你还记得上文里我们提供了Map存储题目选项，同时key的属性存放答案。<em>如果忘记可以往上翻翻</em></li>
<li>这个这个工具类的操作就是将原有Map中的选型乱序操作，<code>也就是A的选项内容给B</code>，<code>B的可能给C</code>，同时记录正确答案在处理后的位置信息</li>
</ul>
<p><strong>克隆对象处理类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QuestionBank</span> <span class="keyword">implements</span> <span class="title">Cloneable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String stuName;<span class="comment">//学生姓名</span></span><br><span class="line">    <span class="keyword">private</span> String stuNum;<span class="comment">//考生号</span></span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;ChoiceQuestion&gt; choiceQuestions = <span class="keyword">new</span> ArrayList&lt;&gt;();<span class="comment">//选择题</span></span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;AnswerQuestion&gt; answerQuestions = <span class="keyword">new</span> ArrayList&lt;&gt;();<span class="comment">//简答题</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 选择题</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> choiceQuestion</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> QuestionBank <span class="title">append</span><span class="params">(ChoiceQuestion choiceQuestion)</span> </span>&#123;</span><br><span class="line">        choiceQuestions.add(choiceQuestion);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 简答题</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> answerQuestion</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> QuestionBank <span class="title">append</span><span class="params">(AnswerQuestion answerQuestion)</span> </span>&#123;</span><br><span class="line">        answerQuestions.add(answerQuestion);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 克隆</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> CloneNotSupportedException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Object <span class="title">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException </span>&#123;</span><br><span class="line">        QuestionBank questionBank = (QuestionBank) <span class="keyword">super</span>.clone();</span><br><span class="line">        questionBank.choiceQuestions = (ArrayList&lt;ChoiceQuestion&gt;) choiceQuestions.clone();</span><br><span class="line">        questionBank.answerQuestions = (ArrayList&lt;AnswerQuestion&gt;) answerQuestions.clone();</span><br><span class="line">        Collections.shuffle(questionBank.choiceQuestions); <span class="comment">//打乱选择题顺序</span></span><br><span class="line">        Collections.shuffle(questionBank.answerQuestions);<span class="comment">//打乱简答题顺序</span></span><br><span class="line">        <span class="comment">//打乱克隆选项及答案顺序</span></span><br><span class="line">        <span class="keyword">for</span> (ChoiceQuestion choiceQuestion : questionBank.choiceQuestions) &#123;</span><br><span class="line">            Topic random = TopicRandomUtil.random(choiceQuestion.getOption(), choiceQuestion.getKey());</span><br><span class="line">            choiceQuestion.setKey(random.getNewKey());</span><br><span class="line">            choiceQuestion.setOption(random.getNewOption());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> questionBank;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getStuName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> stuName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStuName</span><span class="params">(String stuName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.stuName = stuName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getStuNum</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> stuNum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStuNum</span><span class="params">(String stuNum)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.stuNum = stuNum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 打印试卷</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        stringBuilder.append(<span class="string">&quot;姓名:&quot;</span> + stuName + <span class="string">&quot;\t&quot;</span>).append(<span class="string">&quot;考生号:&quot;</span> + stuNum + <span class="string">&quot;\t\n&quot;</span>);</span><br><span class="line">        stringBuilder.append(<span class="string">&quot;-----------------------------------------------------------\t\n&quot;</span>);</span><br><span class="line">        stringBuilder.append(<span class="string">&quot;选择题\t\n&quot;</span>);</span><br><span class="line">        <span class="keyword">int</span> index = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (ChoiceQuestion choiceQuestion : choiceQuestions) &#123;</span><br><span class="line">            Map&lt;String, String&gt; option = choiceQuestion.getOption();</span><br><span class="line">            stringBuilder.append(<span class="string">&quot;第&quot;</span> + index++ + <span class="string">&quot;题:&quot;</span> + choiceQuestion.getName() + <span class="string">&quot;()\t\n&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (String key : option.keySet()) &#123;</span><br><span class="line">                stringBuilder.append(key + <span class="string">&quot;. &quot;</span> + option.get(key) + <span class="string">&quot;\t\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            stringBuilder.append(<span class="string">&quot;答案:&quot;</span> + choiceQuestion.getKey() + <span class="string">&quot;\t\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        stringBuilder.append(<span class="string">&quot;简答题\t\n&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (AnswerQuestion answerQuestion : answerQuestions) &#123;</span><br><span class="line">            stringBuilder.append(<span class="string">&quot;题目:&quot;</span> + answerQuestion.getName() + <span class="string">&quot;?\t\n&quot;</span>);</span><br><span class="line">            stringBuilder.append(<span class="string">&quot;答案:&quot;</span> + answerQuestion.getKey()+<span class="string">&quot;\t\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> stringBuilder.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>这里的主要操作内容有三个，分别是；</p>
<ul>
<li>两个<code>append()</code>，对各项题目的添加，有点像我们在建造者模式中使用的方式，添加装修物料。</li>
<li><code>clone() </code>，这里的核心操作就是对对象的复制，这里的复制不只是包括了本身，同时对两个集合也做了复制。只有这样的拷贝才能确保在操作克隆对象的时候不影响原对象(深拷贝)。<em>深拷贝:对对象中的对象进行克隆</em></li>
<li>乱序操作，在<code>list</code>集合中有一个方法，<code>Collections.shuffle</code>，可以将原有集合的顺序打乱，输出一个新的顺序。在这里我们使用此方法对题目进行乱序操作。</li>
</ul>
<p><strong>初始化试卷数据</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QuestionBankController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> QuestionBank questionBank = <span class="keyword">new</span> QuestionBank();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">QuestionBankController</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Map&lt;String, String&gt; map01 = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">        map01.put(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;JAVA2 EE&quot;</span>);</span><br><span class="line">        map01.put(<span class="string">&quot;B&quot;</span>, <span class="string">&quot;JAVA2 Card&quot;</span>);</span><br><span class="line">        map01.put(<span class="string">&quot;C&quot;</span>, <span class="string">&quot;JAVA2 ME&quot;</span>);</span><br><span class="line">        map01.put(<span class="string">&quot;D&quot;</span>, <span class="string">&quot;JAVA2 HE&quot;</span>);</span><br><span class="line">        map01.put(<span class="string">&quot;E&quot;</span>, <span class="string">&quot;JAVA2 SE&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Map&lt;String, String&gt; map02 = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">        map02.put(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;JAVA程序的main方法必须写在类里面&quot;</span>);</span><br><span class="line">        map02.put(<span class="string">&quot;B&quot;</span>, <span class="string">&quot;JAVA程序中可以有多个main方法&quot;</span>);</span><br><span class="line">        map02.put(<span class="string">&quot;C&quot;</span>, <span class="string">&quot;JAVA程序中类名必须与文件名一样&quot;</span>);</span><br><span class="line">        map02.put(<span class="string">&quot;D&quot;</span>, <span class="string">&quot;JAVA程序的main方法中如果只有一条语句，可以不用&#123;&#125;(大括号)括起来&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Map&lt;String, String&gt; map03 = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">        map03.put(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;变量由字母、下划线、数字、$符号随意组成；&quot;</span>);</span><br><span class="line">        map03.put(<span class="string">&quot;B&quot;</span>, <span class="string">&quot;变量不能以数字作为开头；&quot;</span>);</span><br><span class="line">        map03.put(<span class="string">&quot;C&quot;</span>, <span class="string">&quot;A和a在java中是同一个变量；&quot;</span>);</span><br><span class="line">        map03.put(<span class="string">&quot;D&quot;</span>, <span class="string">&quot;不同类型的变量，可以起相同的名字；&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Map&lt;String, String&gt; map04 = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">        map04.put(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;STRING&quot;</span>);</span><br><span class="line">        map04.put(<span class="string">&quot;B&quot;</span>, <span class="string">&quot;x3x;&quot;</span>);</span><br><span class="line">        map04.put(<span class="string">&quot;C&quot;</span>, <span class="string">&quot;void&quot;</span>);</span><br><span class="line">        map04.put(<span class="string">&quot;D&quot;</span>, <span class="string">&quot;de$f&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Map&lt;String, String&gt; map05 = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">        map05.put(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;31&quot;</span>);</span><br><span class="line">        map05.put(<span class="string">&quot;B&quot;</span>, <span class="string">&quot;0&quot;</span>);</span><br><span class="line">        map05.put(<span class="string">&quot;C&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">        map05.put(<span class="string">&quot;D&quot;</span>, <span class="string">&quot;2&quot;</span>);</span><br><span class="line"></span><br><span class="line">        questionBank.append(<span class="keyword">new</span> ChoiceQuestion(<span class="string">&quot;JAVA所定义的版本中不包括&quot;</span>, map01, <span class="string">&quot;D&quot;</span>))</span><br><span class="line">                .append(<span class="keyword">new</span> ChoiceQuestion(<span class="string">&quot;下列说法正确的是&quot;</span>, map02, <span class="string">&quot;A&quot;</span>))</span><br><span class="line">                .append(<span class="keyword">new</span> ChoiceQuestion(<span class="string">&quot;变量命名规范说法正确的是&quot;</span>, map03, <span class="string">&quot;B&quot;</span>))</span><br><span class="line">                .append(<span class="keyword">new</span> ChoiceQuestion(<span class="string">&quot;以下()不是合法的标识符&quot;</span>,map04, <span class="string">&quot;C&quot;</span>))</span><br><span class="line">                .append(<span class="keyword">new</span> ChoiceQuestion(<span class="string">&quot;表达式(11+3*8)/4%3的值是&quot;</span>, map05, <span class="string">&quot;D&quot;</span>))</span><br><span class="line">                .append(<span class="keyword">new</span> AnswerQuestion(<span class="string">&quot;小红马和小黑马生的小马几条腿&quot;</span>, <span class="string">&quot;4条腿&quot;</span>))</span><br><span class="line">                .append(<span class="keyword">new</span> AnswerQuestion(<span class="string">&quot;铁棒打头疼还是木棒打头疼&quot;</span>, <span class="string">&quot;头最疼&quot;</span>))</span><br><span class="line">                .append(<span class="keyword">new</span> AnswerQuestion(<span class="string">&quot;什么床不能睡觉&quot;</span>, <span class="string">&quot;牙床&quot;</span>))</span><br><span class="line">                .append(<span class="keyword">new</span> AnswerQuestion(<span class="string">&quot;为什么好马不吃回头草&quot;</span>, <span class="string">&quot;后面的草没了&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">createPaper</span><span class="params">(String candidate, String number)</span> <span class="keyword">throws</span> CloneNotSupportedException </span>&#123;</span><br><span class="line">        QuestionBank questionBankClone = (QuestionBank) questionBank.clone();</span><br><span class="line">        questionBankClone.setStuName(candidate);</span><br><span class="line">        questionBankClone.setStuNum(number);</span><br><span class="line">        <span class="keyword">return</span> questionBankClone.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>这个类的内容就比较简单了，主要提供对试卷内容的模式初始化操作(<em>所有考生试卷一样，题目顺序不一致</em>)。</li>
<li>以及对外部提供创建试卷的方法，在创建的过程中使用的是克隆的方式；<code>(QuestionBank) questionBank.clone();</code>，并最终返回试卷信息</li>
</ul>
<p><strong>编写测试类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">get_question_bank</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException </span>&#123;</span><br><span class="line">       QuestionBankController questionBankController = <span class="keyword">new</span> QuestionBankController();</span><br><span class="line">       System.out.println(questionBankController.createPaper(<span class="string">&quot;张三&quot;</span>, <span class="string">&quot;12&quot;</span>));</span><br><span class="line">       System.out.println(questionBankController.createPaper(<span class="string">&quot;李四&quot;</span>, <span class="string">&quot;13&quot;</span>));</span><br><span class="line">       System.out.println(questionBankController.createPaper(<span class="string">&quot;王五&quot;</span>, <span class="string">&quot;14&quot;</span>));</span><br><span class="line">       System.out.println(questionBankController.createPaper(<span class="string">&quot;李六&quot;</span>, <span class="string">&quot;15&quot;</span>));</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<p>结果:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line">姓名:张三	考生号:<span class="number">12</span>	</span><br><span class="line">-----------------------------------------------------------	</span><br><span class="line">选择题	</span><br><span class="line">第<span class="number">1</span>题:下列说法正确的是()	</span><br><span class="line">A. JAVA程序中类名必须与文件名一样	</span><br><span class="line">B. JAVA程序的main方法中如果只有一条语句，可以不用&#123;&#125;(大括号)括起来	</span><br><span class="line">C. JAVA程序的main方法必须写在类里面	</span><br><span class="line">D. JAVA程序中可以有多个main方法	</span><br><span class="line">答案:C	</span><br><span class="line">第<span class="number">2</span>题:变量命名规范说法正确的是()	</span><br><span class="line">A. 变量不能以数字作为开头；	</span><br><span class="line">B. 变量由字母、下划线、数字、$符号随意组成；	</span><br><span class="line">C. A和a在java中是同一个变量；	</span><br><span class="line">D. 不同类型的变量，可以起相同的名字；	</span><br><span class="line">答案:A	</span><br><span class="line">第<span class="number">3</span>题:JAVA所定义的版本中不包括()	</span><br><span class="line">A. JAVA2 EE	</span><br><span class="line">B. JAVA2 Card	</span><br><span class="line">C. JAVA2 ME	</span><br><span class="line">D. JAVA2 HE	</span><br><span class="line">E. JAVA2 SE	</span><br><span class="line">答案:D	</span><br><span class="line">第<span class="number">4</span>题:表达式(<span class="number">11</span>+<span class="number">3</span>*<span class="number">8</span>)/<span class="number">4</span>%<span class="number">3</span>的值是()	</span><br><span class="line">A. <span class="number">2</span>	</span><br><span class="line">B. <span class="number">31</span>	</span><br><span class="line">C. <span class="number">1</span>	</span><br><span class="line">D. <span class="number">0</span>	</span><br><span class="line">答案:A	</span><br><span class="line">第<span class="number">5</span>题:以下()不是合法的标识符()	</span><br><span class="line">A. <span class="keyword">void</span>	</span><br><span class="line">B. STRING	</span><br><span class="line">C. de$f	</span><br><span class="line">D. x3x;	</span><br><span class="line">答案:A	</span><br><span class="line">简答题	</span><br><span class="line">题目:小红马和小黑马生的小马几条腿?	</span><br><span class="line">答案:<span class="number">4</span>条腿	</span><br><span class="line">题目:什么床不能睡觉?	</span><br><span class="line">答案:牙床	</span><br><span class="line">题目:铁棒打头疼还是木棒打头疼?	</span><br><span class="line">答案:头最疼	</span><br><span class="line">题目:为什么好马不吃回头草?	</span><br><span class="line">答案:后面的草没了	</span><br><span class="line"></span><br><span class="line">姓名:李四	考生号:<span class="number">13</span>	</span><br><span class="line">-----------------------------------------------------------	</span><br><span class="line">选择题	</span><br><span class="line">第<span class="number">1</span>题:以下()不是合法的标识符()	</span><br><span class="line">A. de$f	</span><br><span class="line">B. STRING	</span><br><span class="line">C. <span class="keyword">void</span>	</span><br><span class="line">D. x3x;	</span><br><span class="line">答案:C	</span><br><span class="line">第<span class="number">2</span>题:变量命名规范说法正确的是()	</span><br><span class="line">A. A和a在java中是同一个变量；	</span><br><span class="line">B. 变量不能以数字作为开头；	</span><br><span class="line">C. 变量由字母、下划线、数字、$符号随意组成；	</span><br><span class="line">D. 不同类型的变量，可以起相同的名字；	</span><br><span class="line">答案:B	</span><br><span class="line">第<span class="number">3</span>题:表达式(<span class="number">11</span>+<span class="number">3</span>*<span class="number">8</span>)/<span class="number">4</span>%<span class="number">3</span>的值是()	</span><br><span class="line">A. <span class="number">1</span>	</span><br><span class="line">B. <span class="number">2</span>	</span><br><span class="line">C. <span class="number">0</span>	</span><br><span class="line">D. <span class="number">31</span>	</span><br><span class="line">答案:B	</span><br><span class="line">第<span class="number">4</span>题:JAVA所定义的版本中不包括()	</span><br><span class="line">A. JAVA2 Card	</span><br><span class="line">B. JAVA2 HE	</span><br><span class="line">C. JAVA2 SE	</span><br><span class="line">D. JAVA2 ME	</span><br><span class="line">E. JAVA2 EE	</span><br><span class="line">答案:B	</span><br><span class="line">第<span class="number">5</span>题:下列说法正确的是()	</span><br><span class="line">A. JAVA程序的main方法必须写在类里面	</span><br><span class="line">B. JAVA程序中可以有多个main方法	</span><br><span class="line">C. JAVA程序的main方法中如果只有一条语句，可以不用&#123;&#125;(大括号)括起来	</span><br><span class="line">D. JAVA程序中类名必须与文件名一样	</span><br><span class="line">答案:A	</span><br><span class="line">简答题	</span><br><span class="line">题目:小红马和小黑马生的小马几条腿?	</span><br><span class="line">答案:<span class="number">4</span>条腿	</span><br><span class="line">题目:铁棒打头疼还是木棒打头疼?	</span><br><span class="line">答案:头最疼	</span><br><span class="line">题目:什么床不能睡觉?	</span><br><span class="line">答案:牙床	</span><br><span class="line">题目:为什么好马不吃回头草?	</span><br><span class="line">答案:后面的草没了	</span><br><span class="line"></span><br><span class="line">姓名:王五	考生号:<span class="number">14</span>	</span><br><span class="line">-----------------------------------------------------------	</span><br><span class="line">选择题	</span><br><span class="line">第<span class="number">1</span>题:变量命名规范说法正确的是()	</span><br><span class="line">A. 不同类型的变量，可以起相同的名字；	</span><br><span class="line">B. 变量由字母、下划线、数字、$符号随意组成；	</span><br><span class="line">C. 变量不能以数字作为开头；	</span><br><span class="line">D. A和a在java中是同一个变量；	</span><br><span class="line">答案:C	</span><br><span class="line">第<span class="number">2</span>题:表达式(<span class="number">11</span>+<span class="number">3</span>*<span class="number">8</span>)/<span class="number">4</span>%<span class="number">3</span>的值是()	</span><br><span class="line">A. <span class="number">1</span>	</span><br><span class="line">B. <span class="number">2</span>	</span><br><span class="line">C. <span class="number">0</span>	</span><br><span class="line">D. <span class="number">31</span>	</span><br><span class="line">答案:B	</span><br><span class="line">第<span class="number">3</span>题:JAVA所定义的版本中不包括()	</span><br><span class="line">A. JAVA2 EE	</span><br><span class="line">B. JAVA2 HE	</span><br><span class="line">C. JAVA2 Card	</span><br><span class="line">D. JAVA2 SE	</span><br><span class="line">E. JAVA2 ME	</span><br><span class="line">答案:B	</span><br><span class="line">第<span class="number">4</span>题:以下()不是合法的标识符()	</span><br><span class="line">A. STRING	</span><br><span class="line">B. <span class="keyword">void</span>	</span><br><span class="line">C. x3x;	</span><br><span class="line">D. de$f	</span><br><span class="line">答案:B	</span><br><span class="line">第<span class="number">5</span>题:下列说法正确的是()	</span><br><span class="line">A. JAVA程序的main方法必须写在类里面	</span><br><span class="line">B. JAVA程序的main方法中如果只有一条语句，可以不用&#123;&#125;(大括号)括起来	</span><br><span class="line">C. JAVA程序中类名必须与文件名一样	</span><br><span class="line">D. JAVA程序中可以有多个main方法	</span><br><span class="line">答案:A	</span><br><span class="line">简答题	</span><br><span class="line">题目:小红马和小黑马生的小马几条腿?	</span><br><span class="line">答案:<span class="number">4</span>条腿	</span><br><span class="line">题目:什么床不能睡觉?	</span><br><span class="line">答案:牙床	</span><br><span class="line">题目:为什么好马不吃回头草?	</span><br><span class="line">答案:后面的草没了	</span><br><span class="line">题目:铁棒打头疼还是木棒打头疼?	</span><br><span class="line">答案:头最疼	</span><br><span class="line"></span><br><span class="line">姓名:李六	考生号:<span class="number">15</span>	</span><br><span class="line">-----------------------------------------------------------	</span><br><span class="line">选择题	</span><br><span class="line">第<span class="number">1</span>题:以下()不是合法的标识符()	</span><br><span class="line">A. <span class="keyword">void</span>	</span><br><span class="line">B. x3x;	</span><br><span class="line">C. STRING	</span><br><span class="line">D. de$f	</span><br><span class="line">答案:A	</span><br><span class="line">第<span class="number">2</span>题:下列说法正确的是()	</span><br><span class="line">A. JAVA程序的main方法必须写在类里面	</span><br><span class="line">B. JAVA程序中可以有多个main方法	</span><br><span class="line">C. JAVA程序中类名必须与文件名一样	</span><br><span class="line">D. JAVA程序的main方法中如果只有一条语句，可以不用&#123;&#125;(大括号)括起来	</span><br><span class="line">答案:A	</span><br><span class="line">第<span class="number">3</span>题:JAVA所定义的版本中不包括()	</span><br><span class="line">A. JAVA2 EE	</span><br><span class="line">B. JAVA2 HE	</span><br><span class="line">C. JAVA2 ME	</span><br><span class="line">D. JAVA2 SE	</span><br><span class="line">E. JAVA2 Card	</span><br><span class="line">答案:B	</span><br><span class="line">第<span class="number">4</span>题:变量命名规范说法正确的是()	</span><br><span class="line">A. 不同类型的变量，可以起相同的名字；	</span><br><span class="line">B. 变量由字母、下划线、数字、$符号随意组成；	</span><br><span class="line">C. A和a在java中是同一个变量；	</span><br><span class="line">D. 变量不能以数字作为开头；	</span><br><span class="line">答案:D	</span><br><span class="line">第<span class="number">5</span>题:表达式(<span class="number">11</span>+<span class="number">3</span>*<span class="number">8</span>)/<span class="number">4</span>%<span class="number">3</span>的值是()	</span><br><span class="line">A. <span class="number">2</span>	</span><br><span class="line">B. <span class="number">0</span>	</span><br><span class="line">C. <span class="number">1</span>	</span><br><span class="line">D. <span class="number">31</span>	</span><br><span class="line">答案:A	</span><br><span class="line">简答题	</span><br><span class="line">题目:小红马和小黑马生的小马几条腿?	</span><br><span class="line">答案:<span class="number">4</span>条腿	</span><br><span class="line">题目:什么床不能睡觉?	</span><br><span class="line">答案:牙床	</span><br><span class="line">题目:铁棒打头疼还是木棒打头疼?	</span><br><span class="line">答案:头最疼	</span><br><span class="line">题目:为什么好马不吃回头草?	</span><br><span class="line">答案:后面的草没了	</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>总结</strong></p>
<ul>
<li>以上的实际场景模拟了原型模式在开发中重构的作用,但是原型模式的使用频率确实不是很高,如果有一些特殊场景需要使用到,也可以按照此设计模式进行优化,</li>
<li>另外原型设计模式的优点包括；便于通过克隆方式创建复杂对象、也可以避免重复做初始化操作、不需要与类中所属的其他类耦合等。但也有一些缺点如果对象中包括了循环引用的克隆，以及类中深度使用对象的克隆，都会使此模式变得异常麻烦。</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/03/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="冯玮">
      <meta itemprop="description" content="以梦为马，明日天涯">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="冯玮的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/03/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F/" class="post-title-link" itemprop="url">设计模式-建造者模式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-11-03 16:33:39 / 修改时间：17:28:44" itemprop="dateCreated datePublished" datetime="2020-11-03T16:33:39+08:00">2020-11-03</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>建造者模式</strong></p>
<p>建造者模式所完成的额内容及时通过将多个简单对象通过一步步额组装构建出一个复杂对象的过程,</p>
<p>例如你玩王者荣耀时的初始化界面:有三条路,有树木,野怪,守卫塔等等,甚至 依赖于你的网络情况会控制清晰度.而当你换一个场景进行其他不同模式的选择时.同样会建设道路,树木,野怪等等,但是他们的摆放,和大小有不同,这里就可以用到建设者模式来初始化游戏元素.</p>
<p>而这样的根据相同的<code>物料</code>,不同的组装所产生的具体的内容,就是建造者模式的最终意图,也就是:讲一个复杂的构建与表示相分离.</p>
<p><strong>案例场景模拟</strong></p>
<p><img src="https://bugstack.cn/assets/images/2020/itstack-demo-design-3-02.png" alt="image-20201103144120549"></p>
<ol>
<li><p>场景模拟工程</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">src</span><br><span class="line">    └─main</span><br><span class="line">        └─java</span><br><span class="line">            └─org</span><br><span class="line">                └─itstack</span><br><span class="line">                    └─demo</span><br><span class="line">                        └─design</span><br><span class="line">                            │  Matter.java</span><br><span class="line">                            │  package<span class="literal">-info</span>.java</span><br><span class="line">                            │</span><br><span class="line">                            ├─ceiling</span><br><span class="line">                            │      LevelOneCeiling.java</span><br><span class="line">                            │      LevelTwoCeiling.java</span><br><span class="line">                            │</span><br><span class="line">                            ├─coat</span><br><span class="line">                            │      DuluxCoat.java</span><br><span class="line">                            │      LiBangCoat.java</span><br><span class="line">                            │</span><br><span class="line">                            ├─floor</span><br><span class="line">                            │      DerFloor.java</span><br><span class="line">                            │      ShengXiangFloor.java</span><br><span class="line">                            │</span><br><span class="line">                            └─tile</span><br><span class="line">                                    DongPengTile.java</span><br><span class="line">                                    MarcoPoloTile.java</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在模拟工程中提供了装修中所需要的物料:<code>ceilling(吊顶)</code>,<code>coat(涂料)</code>,<code>floor(地板)</code>,<code>tile(地砖)</code></p>
</li>
<li><p>场景简述</p>
<ol>
<li><p>物料接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 装修物料</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Matter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 场景；地板、地砖、涂料、吊顶</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">String <span class="title">scene</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 品牌</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">String <span class="title">brand</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 型号</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">String <span class="title">model</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 平米报价</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">BigDecimal <span class="title">price</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 描述</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">String <span class="title">desc</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ol>
</li>
</ol>
<pre><code>  2.吊顶

  一级顶

  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 吊顶</span></span><br><span class="line"><span class="comment"> * 品牌；装修公司自带</span></span><br><span class="line"><span class="comment"> * 型号：一级顶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LevelOneCeiling</span> <span class="keyword">implements</span> <span class="title">Matter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">scene</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;吊顶&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">brand</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;装修公司自带&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">model</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;一级顶&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BigDecimal <span class="title">price</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BigDecimal(<span class="number">260</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">desc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;造型只做低一级，只有一个层次的吊顶，一般离顶120-150mm&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  二级顶

  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 吊顶</span></span><br><span class="line"><span class="comment"> * 品牌；装修公司自带</span></span><br><span class="line"><span class="comment"> * 型号：二级顶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LevelTwoCeiling</span>  <span class="keyword">implements</span> <span class="title">Matter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">scene</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;吊顶&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">brand</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;装修公司自带&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">model</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;二级顶&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BigDecimal <span class="title">price</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BigDecimal(<span class="number">850</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">desc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;两个层次的吊顶，二级吊顶高度一般就往下吊20cm，要是层高很高，也可增加每级的厚度&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></code></pre>
<ol start="2">
<li><p>涂料</p>
<p>多乐士</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DuluxCoat</span>  <span class="keyword">implements</span> <span class="title">Matter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">scene</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;涂料&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">brand</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;多乐士(Dulux)&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">model</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;第二代&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BigDecimal <span class="title">price</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BigDecimal(<span class="number">719</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">desc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;多乐士是阿克苏诺贝尔旗下的著名建筑装饰油漆品牌，产品畅销于全球100个国家，每年全球有5000万户家庭使用多乐士油漆。&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>立邦</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LiBangCoat</span> <span class="keyword">implements</span> <span class="title">Matter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">scene</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;涂料&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">brand</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;立邦&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">model</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;默认级别&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BigDecimal <span class="title">price</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BigDecimal(<span class="number">650</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">desc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;立邦始终以开发绿色产品、注重高科技、高品质为目标，以技术力量不断推进科研和开发，满足消费者需求。&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</li>
</ol>
<pre><code>  3.地板

  德尔

  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DerFloor</span> <span class="keyword">implements</span> <span class="title">Matter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">scene</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;地板&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">brand</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;德尔(Der)&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">model</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;A+&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BigDecimal <span class="title">price</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BigDecimal(<span class="number">119</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">desc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;DER德尔集团是全球领先的专业木地板制造商，北京2008年奥运会家装和公装地板供应商&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  圣象

  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShengXiangFloor</span> <span class="keyword">implements</span> <span class="title">Matter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">scene</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;地板&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">brand</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;圣象&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">model</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;一级&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BigDecimal <span class="title">price</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BigDecimal(<span class="number">318</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">desc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;圣象地板是中国地板行业著名品牌。圣象地板拥有中国驰名商标、中国名牌、国家免检、中国环境标志认证等多项荣誉。&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  4.地砖

  东鹏

  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DongPengTile</span> <span class="keyword">implements</span> <span class="title">Matter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">scene</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;地砖&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">brand</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;东鹏瓷砖&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">model</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;10001&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BigDecimal <span class="title">price</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BigDecimal(<span class="number">102</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">desc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;东鹏瓷砖以品质铸就品牌，科技推动品牌，口碑传播品牌为宗旨，2014年品牌价值132.35亿元，位列建陶行业榜首。&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  马可波罗

  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MarcoPoloTile</span> <span class="keyword">implements</span> <span class="title">Matter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">scene</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;地砖&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">brand</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;马可波罗(MARCO POLO)&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">model</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;缺省&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BigDecimal <span class="title">price</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BigDecimal(<span class="number">140</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">desc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;“马可波罗”品牌诞生于1996年，作为国内最早品牌化的建陶品牌，以“文化陶瓷”占领市场，享有“仿古砖至尊”的美誉。&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  + 以上就是本次装修公司所提供的`装修配置单`，**接下我们会通过案例去使用不同的物料组合出不同的套餐服务**</code></pre>
<p>   <strong>建造者模式重构代码</strong></p>
<p>建造者模式主要解决的问题是在软件系统中,有时候面临着一个复杂的对象的创建工作,其通常由各个部分的子对象用 一定的过程构成,由于需求的变化,这个复杂对象各个部分经常面临着重大变化,但是他们组在一起的过程相对稳定</p>
<p>这里我们会把构建的过程交给<code>创建者</code>类,而创建者通过我们的<code>构建工具包</code>,去构建出不同的<code>装修套餐</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">itstack-demo-design-3-02</span><br><span class="line">└── src</span><br><span class="line">    ├── main</span><br><span class="line">    │   └── java</span><br><span class="line">    │       └── org.itstack.demo.design</span><br><span class="line">    │           ├── Builder.java    </span><br><span class="line">    │           ├── DecorationPackageMenu.java</span><br><span class="line">    │           └── IMenu.java </span><br><span class="line">    └── test</span><br><span class="line">         └── java</span><br><span class="line">             └── org.itstack.demo.design.test</span><br><span class="line">                 └── ApiTest.java</span><br></pre></td></tr></table></figure>

<p><strong>构建者模型结构</strong></p>
<p><img src="https://bugstack.cn/assets/images/2020/itstack-demo-design-3-03.png" alt="image-20201103152418622"></p>
<p>工程中有三个核心类和一个测试类，核心类是建造者模式的具体实现。与<code>ifelse</code>实现方式相比，多出来了两个额外的类。具体功能如下；</p>
<ul>
<li><code>Builder</code>，建造者类具体的各种组装由此类实现。</li>
<li><code>DecorationPackageMenu</code>，是<code>IMenu</code>接口的实现类，主要是承载建造过程中的填充器。相当于这是一套承载物料和创建者中间衔接的内容。</li>
</ul>
<p><strong>好</strong>，那么接下来会分别讲解几个类的具体实现。</p>
<p><strong>代码实现</strong></p>
<ol>
<li><p>定义装修包接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IMenu</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">IMenu <span class="title">appendCeiling</span><span class="params">(Matter matter)</span></span>; <span class="comment">// 吊顶</span></span><br><span class="line"></span><br><span class="line">    <span class="function">IMenu <span class="title">appendCoat</span><span class="params">(Matter matter)</span></span>;    <span class="comment">// 涂料</span></span><br><span class="line"></span><br><span class="line">    <span class="function">IMenu <span class="title">appendFloor</span><span class="params">(Matter matter)</span></span>;   <span class="comment">// 地板</span></span><br><span class="line"></span><br><span class="line">    <span class="function">IMenu <span class="title">appendTile</span><span class="params">(Matter matter)</span></span>;    <span class="comment">// 地砖</span></span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">getDetail</span><span class="params">()</span></span>;                 <span class="comment">// 明细 </span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>接口类中定义了填充各项物料的方法;<code>吊顶</code>,<code>涂料</code>,<code>地板</code>.<code>地砖</code>.以及最终提供获取全部明细的方法.</li>
</ul>
</li>
<li><p>装修包实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DecorationPackageMenu</span> <span class="keyword">implements</span> <span class="title">IMenu</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Matter&gt; list = <span class="keyword">new</span> ArrayList&lt;Matter&gt;();</span><br><span class="line">    <span class="keyword">private</span> BigDecimal price = BigDecimal.ZERO;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal area;</span><br><span class="line">    <span class="keyword">private</span> String grade;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DecorationPackageMenu</span><span class="params">(Double area, String grade)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.area = <span class="keyword">new</span> BigDecimal(area);</span><br><span class="line">        <span class="keyword">this</span>.grade = grade;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IMenu <span class="title">appendCilling</span><span class="params">(Matter matter)</span> </span>&#123;</span><br><span class="line">        list.add(matter);</span><br><span class="line">        price = price.add(area.multiply(<span class="keyword">new</span> BigDecimal(<span class="string">&quot;0.2&quot;</span>)).multiply(matter.price()));</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IMenu <span class="title">appendCocat</span><span class="params">(Matter matter)</span> </span>&#123;</span><br><span class="line">        list.add(matter);</span><br><span class="line">        price = price.add(area.multiply(<span class="keyword">new</span> BigDecimal(<span class="string">&quot;1.4&quot;</span>)).multiply(matter.price()));</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IMenu <span class="title">appendFloor</span><span class="params">(Matter matter)</span> </span>&#123;</span><br><span class="line">        list.add(matter);</span><br><span class="line">        price = price.add(area.multiply(matter.price()));</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IMenu <span class="title">appendTile</span><span class="params">(Matter matter)</span> </span>&#123;</span><br><span class="line">        list.add(matter);</span><br><span class="line">        price = price.add(area.multiply(matter.price()));</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDetail</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        StringBuilder detail = <span class="keyword">new</span> StringBuilder(<span class="string">&quot;\r\n-------------------------------------------------------\r\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;装修清单&quot;</span> + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;套餐等级：&quot;</span> + grade + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;套餐价格：&quot;</span> + price.setScale(<span class="number">2</span>, BigDecimal.ROUND_HALF_UP) + <span class="string">&quot; 元\r\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;房屋面积：&quot;</span> + area.doubleValue() + <span class="string">&quot; 平米\r\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;材料清单：\r\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Matter matter : list) &#123;</span><br><span class="line">            detail.append(matter.scene()).append(<span class="string">&quot;：&quot;</span>).append(matter.brand()).append(<span class="string">&quot;、&quot;</span>).append(matter.model()).append(<span class="string">&quot;、平米价格：&quot;</span>).append(matter.price()).append(<span class="string">&quot; 元。\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> detail.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>装修包的实现中每一个方法都会了 <code>this</code>，也就可以非常方便的用于连续填充各项物料。</li>
<li>同时在填充时也会根据物料计算平米数下的报价，吊顶和涂料按照平米数适量乘以常熟计算。</li>
<li>最后同样提供了统一的获取装修清单的明细方法。</li>
</ul>
</li>
<li><p>建造者方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Builder</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IMenu <span class="title">levelOne</span><span class="params">(Double area)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DecorationPackageMenu(area, <span class="string">&quot;豪华欧式&quot;</span>)</span><br><span class="line">                .appendCeiling(<span class="keyword">new</span> LevelTwoCeiling())    <span class="comment">// 吊顶，二级顶</span></span><br><span class="line">                .appendCoat(<span class="keyword">new</span> DuluxCoat())             <span class="comment">// 涂料，多乐士</span></span><br><span class="line">                .appendFloor(<span class="keyword">new</span> ShengXiangFloor());     <span class="comment">// 地板，圣象</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IMenu <span class="title">levelTwo</span><span class="params">(Double area)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DecorationPackageMenu(area, <span class="string">&quot;轻奢田园&quot;</span>)</span><br><span class="line">                .appendCeiling(<span class="keyword">new</span> LevelTwoCeiling())   <span class="comment">// 吊顶，二级顶</span></span><br><span class="line">                .appendCoat(<span class="keyword">new</span> LiBangCoat())           <span class="comment">// 涂料，立邦</span></span><br><span class="line">                .appendTile(<span class="keyword">new</span> MarcoPoloTile());       <span class="comment">// 地砖，马可波罗</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IMenu <span class="title">levelThree</span><span class="params">(Double area)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DecorationPackageMenu(area, <span class="string">&quot;现代简约&quot;</span>)</span><br><span class="line">                .appendCeiling(<span class="keyword">new</span> LevelOneCeiling())   <span class="comment">// 吊顶，二级顶</span></span><br><span class="line">                .appendCoat(<span class="keyword">new</span> LiBangCoat())           <span class="comment">// 涂料，立邦</span></span><br><span class="line">                .appendTile(<span class="keyword">new</span> DongPengTile());        <span class="comment">// 地砖，东鹏</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>建造者的使用中就已经非常容易了，统一的建造方式，通过不同物料填充出不同的装修风格；<code>豪华欧式</code>、<code>轻奢田园</code>、<code>现代简约</code>，如果将来业务扩展也可以将这部分内容配置到数据库自动生成。但整体的思想还可以使用创建者模式进行搭建。</li>
</ul>
</li>
</ol>
<p><strong>总结</strong></p>
<ul>
<li>通过上面对建造者模式的使用，已经可以摸索出一点心得。那就是什么时候会选择这样的设计模式，当：<code>一些基本物料不会变，而其组合经常变化的时候</code>，就可以选择这样的设计模式来构建代码。</li>
<li>此设计模式满足了单一职责原则以及可复用的技术、建造者独立、易扩展、便于控制细节风险。但同时当出现特别多的物料以及很多的组合后，类的不断扩展也会造成难以维护的问题。但这种设计结构模型可以把重复的内容抽象到数据库中，按照需要配置。这样就可以减少代码中大量的重复。</li>
<li>设计模式能带给你的是一些思想，但在平时的开发中怎么样清晰的提炼出符合此思路的建造模块，是比较难的。需要经过一些锻炼和不断承接更多的项目，从而获得这部分经验。有的时候你的代码写的好，往往是倒逼的，复杂的业务频繁的变化，不断的挑战！</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/02/java%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E6%9C%BA%E5%88%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="冯玮">
      <meta itemprop="description" content="以梦为马，明日天涯">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="冯玮的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/02/java%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E6%9C%BA%E5%88%B6/" class="post-title-link" itemprop="url">java动态代理机制</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-11-02 10:04:20 / 修改时间：10:05:36" itemprop="dateCreated datePublished" datetime="2020-11-02T10:04:20+08:00">2020-11-02</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="java动态代理机制"><a href="#java动态代理机制" class="headerlink" title="java动态代理机制"></a>java动态代理机制</h1><blockquote>
<p>在学习Spring的时候，我们知道Spring主要有两大思想，一个是IoC，另一个就是AOP，对于IoC，依赖注入就不用多说了，而对于Spring的核心AOP来说，我们不但要知道怎么通过AOP来满足我们的功能，我们更需要学习的是其底层是怎么样的一个原理，而AOP的原理就是Java的动态代理机制，所以本篇随笔就是对Java的动态机制进行一个回顾。</p>
</blockquote>
<h3 id="首先问一个问题，为什么需要动态代理？"><a href="#首先问一个问题，为什么需要动态代理？" class="headerlink" title="首先问一个问题，为什么需要动态代理？"></a>首先问一个问题，为什么需要动态代理？</h3><ul>
<li>代码混乱：越来越多的非业务需求(日志和验证等)加入后，原有的业务方法急剧膨胀。每个方法在处理核心逻辑的同时还必须兼顾其他多个关注点。比如：每新添加了方法，还得继续写日志和验证。</li>
<li>代码分散：以日志需求为例，只是为了满足这个单一需求，就不得不在多个模块（方法）里多次重复相同的日志代码。如果日志需求发生变化，必须修改所有模块。比如：现在此类的方法里都显示方法名，那么每个方法都得一个一个改。</li>
</ul>
<h3 id="机制讲解"><a href="#机制讲解" class="headerlink" title="机制讲解"></a>机制讲解</h3><p>在Java的动态代理机制中，有两个重要的类或接口，一个是 InvocationHandler(Interface)、另一个则是 Proxy(Class)，这一个类和接口是实现我们动态代理所必须用到的。首先我们先来看看Java的API帮助文档是怎么样对这两个类进行描述的：</p>
<p>InvocationHandler：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">InvocationHandler is the <span class="class"><span class="keyword">interface</span> <span class="title">implemented</span> <span class="title">by</span> <span class="title">the</span> <span class="title">invocation</span> <span class="title">handler</span> <span class="title">of</span> <span class="title">a</span> <span class="title">proxy</span> <span class="title">instance</span>. </span></span><br><span class="line"><span class="class"><span class="title">Each</span> <span class="title">proxy</span> <span class="title">instance</span> <span class="title">has</span> <span class="title">an</span> <span class="title">associated</span> <span class="title">invocation</span> <span class="title">handler</span>. <span class="title">When</span> <span class="title">a</span> <span class="title">method</span> <span class="title">is</span> <span class="title">invoked</span> <span class="title">on</span> <span class="title">a</span> <span class="title">proxy</span> <span class="title">instance</span>, <span class="title">the</span> <span class="title">method</span> <span class="title">invocation</span> <span class="title">is</span> <span class="title">encoded</span> <span class="title">and</span> <span class="title">dispatched</span> <span class="title">to</span> <span class="title">the</span> <span class="title">invoke</span> <span class="title">method</span> <span class="title">of</span> <span class="title">its</span> <span class="title">invocation</span> <span class="title">handler</span>.</span></span><br></pre></td></tr></table></figure>

<p>每一个动态代理类都必须要实现InvocationHandler这个接口，并且每个代理类的实例都关联到了一个handler，当我们通过代理对象调用一个方法的时候，这个方法的调用就会被转发为由InvocationHandler这个接口的 invoke 方法来进行调用。我们来看看InvocationHandler这个接口的唯一一个方法 invoke 方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable</span></span><br></pre></td></tr></table></figure>

<p>我们看到这个方法一共接受三个参数，那么这三个参数分别代表什么呢？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable</span></span><br><span class="line"><span class="function">proxy:　 - 指代我们所代理的那个真实对象</span></span><br><span class="line"><span class="function">method:　- 指代的是我们所要调用真实对象的某个方法的Method对象</span></span><br><span class="line"><span class="function">args:　　- 指代的是调用真实对象某个方法时接受的参数</span></span><br></pre></td></tr></table></figure>

<p>如果不是很明白，等下通过一个实例会对这几个参数进行更深的讲解。</p>
<p>接下来我们来看看 Proxy 这个类：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Proxy provides static methods for creating dynamic proxy classes and instances, and it is also the superclass of all dynamic proxy classes created by those methods. </span><br></pre></td></tr></table></figure>

<p>Proxy这个类的作用就是用来动态创建一个代理对象的类，它提供了许多的方法，但是我们用的最多的就是 newProxyInstance 这个方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">newProxyInstance</span><span class="params">(ClassLoader loader, Class&lt;?&gt;[] interfaces,  InvocationHandler h)</span>  <span class="keyword">throws</span> IllegalArgumentException</span></span><br><span class="line"><span class="function">Returns an instance of a proxy class <span class="keyword">for</span> the specified interfaces that dispatches method invocations to the specified invocation handler.</span></span><br></pre></td></tr></table></figure>

<p>这个方法的作用就是得到一个动态的代理对象，其接收三个参数，我们来看看这三个参数所代表的含义：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">newProxyInstance</span><span class="params">(ClassLoader loader, Class&lt;?&gt;[] interfaces, InvocationHandler h)</span> <span class="keyword">throws</span> IllegalArgumentException</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">loader: 一个ClassLoader对象，定义了由哪个ClassLoader对象来对生成的代理对象进行加载</span></span><br><span class="line"><span class="function">interfaces:　　一个Interface对象的数组，表示的是我将要给我需要代理的对象提供一组什么接口，如果我提供了一组接口给它，那么这个代理对象就宣称实现了该接口<span class="params">(多态)</span>，这样我就能调用这组接口中的方法了</span></span><br><span class="line"><span class="function">h:一个InvocationHandler对象，表示的是当我这个动态代理对象在调用方法的时候，会关联到哪一个InvocationHandler对象上</span></span><br></pre></td></tr></table></figure>

<p>好了，在介绍完这两个接口(类)以后，我们来通过一个实例来看看我们的动态代理模式是什么样的：</p>
<p>首先我们定义了一个Subject类型的接口，为其声明了两个方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">rent</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">say</span><span class="params">(String msg)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接着，定义了一个类来实现这个接口，这个类就是我们的真实对象，RealSubject类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RealSubject</span> <span class="keyword">implements</span> <span class="title">Subject</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;I want rent my house&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">say</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        System.out.println(msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下一步，我们就要定义一个动态代理类了，前面说个，每一个动态代理类都必须要实现 InvocationHandler 这个接口，因此我们这个动态代理类也不例外：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dynamic</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Object subject;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Dynamic</span><span class="params">(Object subject)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.subject = subject;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;before rent house&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;method=&quot;</span>+method);</span><br><span class="line">        method.invoke(subject,args);</span><br><span class="line">        System.out.println(<span class="string">&quot;after rent house&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后，来看看我们的Client类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 我们要代理的真实对象</span></span><br><span class="line">        Subject realSubject = <span class="keyword">new</span> RealSubject();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 我们要代理哪个真实对象，就将该对象传进去，最后是通过该真实对象来调用其方法的</span></span><br><span class="line">        InvocationHandler handler = <span class="keyword">new</span> Dynamic(realSubject);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 通过Proxy的newProxyInstance方法来创建我们的代理对象，我们来看看其三个参数</span></span><br><span class="line"><span class="comment">         * 第一个参数handler.getClass().getClassLoader()，我们这里使用handler这个类的ClassLoader对象来加载我们的代理对象</span></span><br><span class="line"><span class="comment">         * 第二个参数realSubject.getClass().getInterfaces()，我们这里为代理对象提供的接口是真实对象所实行的接口，表示我要代理的是该真实对象，这样我            就能调用这组接口中的方法了</span></span><br><span class="line"><span class="comment">         * 第三个参数handler，我们这里将这个代理对象关联到了上方的 InvocationHandler 这个对象上</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Subject subject = (Subject) Proxy.newProxyInstance(handler.getClass().getClassLoader(), realSubject</span><br><span class="line">                .getClass().getInterfaces(), handler);</span><br><span class="line"></span><br><span class="line">        System.out.println(subject.getClass().getName());</span><br><span class="line">        subject.rent();</span><br><span class="line">        subject.say(<span class="string">&quot;world&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们先来看看控制台的输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">com.sun.proxy.$Proxy0</span><br><span class="line">before rent house</span><br><span class="line">method&#x3D;public abstract void org.itstack.demo.proxy.Subject.rent()</span><br><span class="line">I want rent my house</span><br><span class="line">after rent house</span><br><span class="line">before rent house</span><br><span class="line">method&#x3D;public abstract void org.itstack.demo.proxy.Subject.say(java.lang.String)</span><br><span class="line">world</span><br><span class="line">after rent house</span><br></pre></td></tr></table></figure>

<p>我们首先来看看 $Proxy0 这东西，我们看到，这个东西是由 System.out.println(subject.getClass().getName()); 这条语句打印出来的，那么为什么我们返回的这个代理对象的类名是这样的呢？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Subject subject = (Subject)Proxy.newProxyInstance(handler.getClass().getClassLoader(), realSubject.getClass().getInterfaces(), handler);</span><br></pre></td></tr></table></figure>

<p>可能我以为返回的这个代理对象会是Subject类型的对象，或者是InvocationHandler的对象，结果却不是，首先我们解释一下<strong>为什么我们这里可以将其转化为Subject类型的对象？</strong>原因就是在newProxyInstance这个方法的第二个参数上，我们给这个代理对象提供了一组什么接口，那么我这个代理对象就会实现了这组接口，这个时候我们当然可以将这个代理对象强制类型转化为这组接口中的任意一个，因为这里的接口是Subject类型，所以就可以将其转化为Subject类型了。</p>
<p><strong>同时我们一定要记住，通过 Proxy.newProxyInstance 创建的代理对象是在jvm运行时动态生成的一个对象，它并不是我们的InvocationHandler类型，也不是我们定义的那组接口的类型，而是在运行是动态生成的一个对象，并且命名方式都是这样的形式，以$开头，proxy为中，最后一个数字表示对象的标号</strong>。</p>
<p>接着我们来看看这两句 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">subject.rent();</span><br><span class="line"></span><br><span class="line">subject.hello(<span class="string">&quot;world&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>这里是通过代理对象来调用实现的那种接口中的方法，这个时候程序就会跳转到由这个代理对象关联到的 handler 中的 invoke 方法去执行，而我们的这个 handler 对象又接受了一个 RealSubject 类型的参数，表示我要代理的就是这个真实对象，所以此时就会调用 handler 中的 invoke 方法去执行：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;before rent house&quot;</span>);</span><br><span class="line">       System.out.println(<span class="string">&quot;method=&quot;</span>+method);</span><br><span class="line">       method.invoke(subject,args);</span><br><span class="line">       System.out.println(<span class="string">&quot;after rent house&quot;</span>);</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>我们看到，在真正通过代理对象来调用真实对象的方法的时候，我们可以在该方法前后添加自己的一些操作，同时我们看到我们的这个 method 对象是这样的：</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">method=public abstract void org.itstack.demo.proxy.Subject.rent()</span><br><span class="line">method=public abstract void org.itstack.demo.proxy.Subject.say(java.lang.String)</span><br></pre></td></tr></table></figure>

<p>正好就是我们的Subject接口中的两个方法，这也就证明了当我通过代理对象来调用方法的时候，起实际就是委托由其关联到的 handler 对象的invoke方法中来调用，并不是自己来真实调用，而是通过代理的方式来调用的。</p>
<p>这就是我们的java动态代理机制。</p>
<blockquote>
<p>本篇随笔详细的讲解了java中的动态代理机制，这个知识点非常非常的重要，包括我们Spring的AOP其就是通过动态代理的机制实现的，所以我们必须要好好的理解动态代理的机制。</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/30/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E5%B7%A5%E5%8E%82%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="冯玮">
      <meta itemprop="description" content="以梦为马，明日天涯">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="冯玮的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/30/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-%E5%B7%A5%E5%8E%82%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" class="post-title-link" itemprop="url">设计模式-工厂设计模式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-10-30 10:08:56 / 修改时间：10:13:27" itemprop="dateCreated datePublished" datetime="2020-10-30T10:08:56+08:00">2020-10-30</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="工厂方法模式"><a href="#工厂方法模式" class="headerlink" title="工厂方法模式"></a>工厂方法模式</h1><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9idWdzdGFjay5jbi9hc3NldHMvaW1hZ2VzLzIwMjAvaXRzdGFjay1kZW1vLWRlc2lnbi0xLTAxLnBuZw?x-oss-process=image/format,png"></p>
<ul>
<li>工厂模式</li>
</ul>
<p>工厂模式又称为工厂方法模式,是一种创建型设计模式,其在父类中提供一个创建对象的方法,允许子类决定实例化对象的类型.</p>
<p>这种设计模式也是java开发中最常见的一种模式,他的主要意图是定义个亿创建对象的接口,让其子类自己决定实例化哪一个工厂类,工厂模式使其创建过程延迟到子类进行.</p>
<p>简单说就是为了提供代码结果的扩展性,屏蔽每一个功能类中的具体实现逻辑,让外部可以更加简单的只是知道调用即可,同事这也是去掉众多<code>ifelse</code>的方式,当然这可能也有缺点,比如需要实现的类非常的多,如何去维护,怎么样减低开发成本,但这些问题都可以在后续的设计模式中结合使用,逐步降低.</p>
<ul>
<li>模拟发奖多种商品</li>
</ul>
<table>
<thead>
<tr>
<th>序号</th>
<th>类型</th>
<th>接口</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>优惠券</td>
<td><code>CouponResult sendCoupon(String uId, String couponNumber, String uuid)</code></td>
</tr>
<tr>
<td>2</td>
<td>实物商品</td>
<td><code>Boolean deliverGoods(DeliverReq req)</code></td>
</tr>
<tr>
<td>3</td>
<td>第三方爱奇艺兑换卡</td>
<td><code>void grantToken(String bindMobileNumber, String cardId)</code></td>
</tr>
</tbody></table>
<p>分析接口:</p>
<ul>
<li>三个接口的返回类型不同,对象类型、布尔类型、还有不反悔类型</li>
<li>入参不同，发放优惠券需要防重、兑换卡需要卡id、实物商品需要发货的位置等</li>
<li>另外可能会随着业务的发展，会增加其他的商品类型，因为你所有的开发需求都是随着市场的拓展而带来的</li>
</ul>
<h2 id="简单的实现"><a href="#简单的实现" class="headerlink" title="简单的实现"></a>简单的实现</h2><ol>
<li><p>工程目录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">├─src</span><br><span class="line">│  ├─main</span><br><span class="line">│  │  └─java</span><br><span class="line">│  │      └─org</span><br><span class="line">│  │          └─itstack</span><br><span class="line">│  │              └─demo</span><br><span class="line">│  │                  └─design</span><br><span class="line">│  │                          AwardReq.java</span><br><span class="line">│  │                          AwardRes.java</span><br><span class="line">│  │                          PrizeController.java</span><br><span class="line">│  │</span><br><span class="line">│  └─test</span><br><span class="line">│      └─java</span><br><span class="line">│          └─org</span><br><span class="line">│              └─itstack</span><br><span class="line">│                  └─demo</span><br><span class="line">│                      └─test</span><br><span class="line">│                             ApiTest.java</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>工程结构上非常简单,一个入参对象<code>AwardReq</code>、一个出参对象<code>AwardRes</code>,以及一个接口类<code>PrizeController</code></li>
</ul>
</li>
<li><p><code>ifelse</code>实现需求</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PrizeController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(PrizeController.class);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AwardRes <span class="title">awardToUser</span><span class="params">(AwardReq req)</span> </span>&#123;</span><br><span class="line">        String reqJson = JSON.toJSONString(req);</span><br><span class="line">        AwardRes awardRes = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            logger.info(<span class="string">&quot;奖品发放开始&#123;&#125;。req:&#123;&#125;&quot;</span>, req.getuId(), reqJson);</span><br><span class="line">            <span class="comment">// 按照不同类型方法商品[1优惠券、2实物商品、3第三方兑换卡(爱奇艺)]</span></span><br><span class="line">            <span class="keyword">if</span> (req.getAwardType() == <span class="number">1</span>) &#123;</span><br><span class="line">                CouponService couponService = <span class="keyword">new</span> CouponService();</span><br><span class="line">                CouponResult couponResult = couponService.sendCoupon(req.getuId(), req.getAwardNumber(), req.getBizId());</span><br><span class="line">                <span class="keyword">if</span> (<span class="string">&quot;0000&quot;</span>.equals(couponResult.getCode())) &#123;</span><br><span class="line">                    awardRes = <span class="keyword">new</span> AwardRes(<span class="string">&quot;0000&quot;</span>, <span class="string">&quot;发放成功&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    awardRes = <span class="keyword">new</span> AwardRes(<span class="string">&quot;0001&quot;</span>, couponResult.getInfo());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (req.getAwardType() == <span class="number">2</span>) &#123;</span><br><span class="line">                GoodsService goodsService = <span class="keyword">new</span> GoodsService();</span><br><span class="line">                DeliverReq deliverReq = <span class="keyword">new</span> DeliverReq();</span><br><span class="line">                deliverReq.setUserName(queryUserName(req.getuId()));</span><br><span class="line">                deliverReq.setUserPhone(queryUserPhoneNumber(req.getuId()));</span><br><span class="line">                deliverReq.setSku(req.getAwardNumber());</span><br><span class="line">                deliverReq.setOrderId(req.getBizId());</span><br><span class="line">                deliverReq.setConsigneeUserName(req.getExtMap().get(<span class="string">&quot;consigneeUserName&quot;</span>));</span><br><span class="line">                deliverReq.setConsigneeUserPhone(req.getExtMap().get(<span class="string">&quot;consigneeUserPhone&quot;</span>));</span><br><span class="line">                deliverReq.setConsigneeUserAddress(req.getExtMap().get(<span class="string">&quot;consigneeUserAddress&quot;</span>));</span><br><span class="line">                Boolean isSuccess = goodsService.deliverGoods(deliverReq);</span><br><span class="line">                <span class="keyword">if</span> (isSuccess) &#123;</span><br><span class="line">                    awardRes = <span class="keyword">new</span> AwardRes(<span class="string">&quot;0000&quot;</span>, <span class="string">&quot;发放成功&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    awardRes = <span class="keyword">new</span> AwardRes(<span class="string">&quot;0001&quot;</span>, <span class="string">&quot;发放失败&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (req.getAwardType() == <span class="number">3</span>) &#123;</span><br><span class="line">                String bindMobileNumber = queryUserPhoneNumber(req.getuId());</span><br><span class="line">                IQiYiCardService iQiYiCardService = <span class="keyword">new</span> IQiYiCardService();</span><br><span class="line">                iQiYiCardService.grantToken(bindMobileNumber, req.getAwardNumber());</span><br><span class="line">                awardRes = <span class="keyword">new</span> AwardRes(<span class="string">&quot;0000&quot;</span>, <span class="string">&quot;发放成功&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            logger.info(<span class="string">&quot;奖品发放完成&#123;&#125;。&quot;</span>, req.getuId());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;奖品发放失败&#123;&#125;。req:&#123;&#125;&quot;</span>, req.getuId(), reqJson, e);</span><br><span class="line">            awardRes = <span class="keyword">new</span> AwardRes(<span class="string">&quot;0001&quot;</span>, e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> awardRes;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">queryUserName</span><span class="params">(String uId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;花花&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">queryUserPhoneNumber</span><span class="params">(String uId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;15200101232&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>以上的代码就是典型的使用<code>ifelse</code>非常直接的实现出来的业务需求的一坨代码,如何仅从业务的角度看,研发如期甚至提前实现了功能</li>
<li>那这样的代码目前来看没有什么问题,但是经过几次迭代和拓展,接手这段代码的研发将会十分的痛苦,重构成本高,需要整理之前每一个接口的使用,测试回归验证时间长,需要全部验证一次,这就是很多人不愿意接受别人的代码,如果接手了 又要被压榨开发时间,那么可想而知这样的<code>ifelse</code>还会不停的增加.</li>
</ul>
<p>##　使用工厂模式重构</p>
<ol>
<li>目录结构</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">├─src</span><br><span class="line">│  ├─main</span><br><span class="line">│  │  └─java</span><br><span class="line">│  │      └─org</span><br><span class="line">│  │          └─itstack</span><br><span class="line">│  │              └─demo</span><br><span class="line">│  │                  └─design</span><br><span class="line">│  │                      │  StoreFactory.java</span><br><span class="line">│  │                      │</span><br><span class="line">│  │                      └─store</span><br><span class="line">│  │                          │  ICommodity.java</span><br><span class="line">│  │                          │</span><br><span class="line">│  │                          └─impl</span><br><span class="line">│  │                                  CardCommodityService.java</span><br><span class="line">│  │                                  CouponCommodityService.java</span><br><span class="line">│  │                                  GoodsCommodityService.java</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>首先，从上面的工程结构中，他看上去更加清晰了，更加明确每一个类所拥有的功能</li>
</ul>
<ol start="2">
<li><p>代码实现</p>
<p>2.1 定义发奖类接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ICommodity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">sendCommodity</span><span class="params">(String uId, String commodityId, String bizId, Map&lt;String, String&gt; extMap)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>所有的奖品无论是实物还是虚拟物品，都需要实现此接口进行处理，以保证最终入参的统一性</li>
<li>接口的入参包括：<code>用户ID</code>,<code>奖品ID</code>,<code>业务ID</code>以及<code>扩展字段</code>用于处理发放事务商品时收货的地址等信息</li>
</ul>
<p>2.2 实现奖品发放接口</p>
<p>优惠券</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CouponCommodityService</span> <span class="keyword">implements</span> <span class="title">ICommodity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(CouponCommodityService.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> CouponService couponService = <span class="keyword">new</span> CouponService();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendCommodity</span><span class="params">(String uId, String commodityId, String bizId, Map&lt;String, String&gt; extMap)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        CouponResult couponResult = couponService.sendCoupon(uId, commodityId, bizId);</span><br><span class="line">        logger.info(<span class="string">&quot;请求参数[优惠券] =&gt; uId：&#123;&#125; commodityId：&#123;&#125; bizId：&#123;&#125; extMap：&#123;&#125;&quot;</span>, uId, commodityId, bizId, JSON.toJSON(extMap));</span><br><span class="line">        logger.info(<span class="string">&quot;测试结果[优惠券]：&#123;&#125;&quot;</span>, JSON.toJSON(couponResult));</span><br><span class="line">        <span class="keyword">if</span> (!<span class="string">&quot;0000&quot;</span>.equals(couponResult.getCode())) <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(couponResult.getInfo());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>爱奇艺</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CardCommodityService</span> <span class="keyword">implements</span> <span class="title">ICommodity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(CardCommodityService.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 模拟注入</span></span><br><span class="line">    <span class="keyword">private</span> IQiYiCardService iQiYiCardService = <span class="keyword">new</span> IQiYiCardService();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendCommodity</span><span class="params">(String uId, String commodityId, String bizId, Map&lt;String, String&gt; extMap)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String mobile = queryUserMobile(uId);</span><br><span class="line">        iQiYiCardService.grantToken(mobile, bizId);</span><br><span class="line">        logger.info(<span class="string">&quot;请求参数[爱奇艺兑换卡] =&gt; uId：&#123;&#125; commodityId：&#123;&#125; bizId：&#123;&#125; extMap：&#123;&#125;&quot;</span>, uId, commodityId, bizId, JSON.toJSON(extMap));</span><br><span class="line">        logger.info(<span class="string">&quot;测试结果[爱奇艺兑换卡]：success&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">queryUserMobile</span><span class="params">(String uId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;15200101232&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实物</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GoodsCommodityService</span> <span class="keyword">implements</span> <span class="title">ICommodity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(GoodsCommodityService.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> GoodsService goodsService = <span class="keyword">new</span> GoodsService();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendCommodity</span><span class="params">(String uId, String commodityId, String bizId, Map&lt;String, String&gt; extMap)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        DeliverReq deliverReq = <span class="keyword">new</span> DeliverReq();</span><br><span class="line">        deliverReq.setUserName(queryUserName(uId));</span><br><span class="line">        deliverReq.setUserPhone(queryUserPhoneNumber(uId));</span><br><span class="line">        deliverReq.setSku(commodityId);</span><br><span class="line">        deliverReq.setOrderId(bizId);</span><br><span class="line">        deliverReq.setConsigneeUserName(extMap.get(<span class="string">&quot;consigneeUserName&quot;</span>));</span><br><span class="line">        deliverReq.setConsigneeUserPhone(extMap.get(<span class="string">&quot;consigneeUserPhone&quot;</span>));</span><br><span class="line">        deliverReq.setConsigneeUserAddress(extMap.get(<span class="string">&quot;consigneeUserAddress&quot;</span>));</span><br><span class="line"></span><br><span class="line">        Boolean isSuccess = goodsService.deliverGoods(deliverReq);</span><br><span class="line"></span><br><span class="line">        logger.info(<span class="string">&quot;请求参数[优惠券] =&gt; uId：&#123;&#125; commodityId：&#123;&#125; bizId：&#123;&#125; extMap：&#123;&#125;&quot;</span>, uId, commodityId, bizId, JSON.toJSON(extMap));</span><br><span class="line">        logger.info(<span class="string">&quot;测试结果[优惠券]：&#123;&#125;&quot;</span>, isSuccess);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!isSuccess) <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;实物商品发放失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">queryUserName</span><span class="params">(String uId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;花花&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">queryUserPhoneNumber</span><span class="params">(String uId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;15200101232&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.3 创建商品工厂</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StoreFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ICommodity <span class="title">getCommodityService</span><span class="params">(Integer commodityType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == commodityType) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">1</span> == commodityType) <span class="keyword">return</span> <span class="keyword">new</span> CouponCommodityService();</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">2</span> == commodityType) <span class="keyword">return</span> <span class="keyword">new</span> GoodsCommodityService();</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">3</span> == commodityType) <span class="keyword">return</span> <span class="keyword">new</span> CardCommodityService();</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;不存在的商品服务类型&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>这里我们定义了一个商店的工厂类,在里面按照类型实现各种商品的服务,可以非常干净整洁的处理你的代码.后续增加的商品在这里扩展即可,如果你不喜欢<code>if</code>判断,也可以使用<code>switch</code>或<code>map</code>配置结构,会让代码更加干净.</li>
</ul>
</li>
</ol>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul>
<li>从上到下的优化来看,工厂方法模式并不复杂</li>
<li>工厂模式的优点,<code>避免创建者与具体的产品逻辑耦合</code>,<code>满足单一职责,每一个业务逻辑实现都在自己所属的类中完成</code>,<code>满足开闭原则,无需更改使用调用方法就可以在程序中引入新的产品类型</code>.</li>
<li>工厂模式的缺点:结合优点来看,这样也会带来一些问题, 比如有非常多的奖品类型,那么实现的子类会极速扩张,因此也需要使用其他的模式来进行优化,后面逐渐学到</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">冯玮</p>
  <div class="site-description" itemprop="description">以梦为马，明日天涯</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">13</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">冯玮</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
